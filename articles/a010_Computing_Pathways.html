<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Computing Pathways • TreatmentPatterns</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Computing Pathways">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">TreatmentPatterns</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a000_bestPractices.html">Best practices</a></li>
    <li><a class="dropdown-item" href="../articles/a001_DefiningCohorts.html">Defining Cohorts</a></li>
    <li><a class="dropdown-item" href="../articles/a010_Computing_Pathways.html">Computing Pathways</a></li>
    <li><a class="dropdown-item" href="../articles/a020_Exporting.html">Exporing Results</a></li>
    <li><a class="dropdown-item" href="../articles/a030_Evaluating_Output.html">Evaluating Output</a></li>
    <li><a class="dropdown-item" href="../articles/a999_Strategus.html">Strategus Execution</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/darwin-eu/TreatmentPatterns/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Computing Pathways</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/darwin-eu/TreatmentPatterns/blob/main/vignettes/a010_Computing_Pathways.Rmd" class="external-link"><code>vignettes/a010_Computing_Pathways.Rmd</code></a></small>
      <div class="d-none name"><code>a010_Computing_Pathways.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="target-and-event-cohorts">Target and Event cohorts<a class="anchor" aria-label="anchor" href="#target-and-event-cohorts"></a>
</h2>
<p>TreatmentPatterns build pathways of <strong>event</strong> cohorts,
that occur during a <strong>target</strong> cohort. A target cohort in
published studies is usually a disease. But other use cases is also
valid. Like an exposure window to a drug or treatment.</p>
<p>Events are things that happen during the target cohort window. For
published studies these are usually exposures to drugs or treatments
during a disease. To re-frame that into a research question:
<strong>“What is the order and pathway of treatments during an
infection”</strong>.</p>
<p>Our target cohort would be the infection itself, the event cohorts
would be the treatments that occur during the infection.</p>
<p>TreatmentPatterns needs to know which cohort is a target cohort and
which is an event cohort. This can be derived from the cohort set table,
usually generated by either <code>CDMConnector</code> or
<code>CohortGenerator</code>. To let TreatmentPatterns know which cohort
is what kind, we supply a table that contains a 1) ID, 2) Name, and 3)
cohort type. As an example:</p>
<table class="table">
<thead><tr class="header">
<th>cohortId</th>
<th>cohortName</th>
<th>type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Infection</td>
<td>target</td>
</tr>
<tr class="even">
<td>2</td>
<td>Treatment A</td>
<td>event</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Treatment B</td>
<td>event</td>
</tr>
<tr class="even">
<td>4</td>
<td>Treatment C</td>
<td>event</td>
</tr>
</tbody>
</table>
<p>Like mentioned earlier this table can be easily dirived from a cohort
set generated by <code>CohortGenerator</code> or
<code>CDMConnector</code>. Here is an example that uses
<code>CDMConnector</code>. The target cohort is <em>Viral
Sinusitis</em>, the events are several treatments:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu.github.io/CDMConnector/" class="external-link">CDMConnector</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">cohortSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/readCohortSet.html" class="external-link">readCohortSet</a></span><span class="op">(</span></span>
<span>  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"TreatmentPatterns"</span>, <span class="st">"exampleCohorts"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cohorts</span> <span class="op">&lt;-</span> <span class="va">cohortSet</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Remove 'cohort' and 'json' columns</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="st">"cohort"</span>, <span class="op">-</span><span class="st">"json"</span>, <span class="op">-</span><span class="st">"cohort_name_snakecase"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"event"</span>, <span class="st">"event"</span>, <span class="st">"event"</span>, <span class="st">"event"</span>, <span class="st">"exit"</span>, <span class="st">"event"</span>, <span class="st">"event"</span>, <span class="st">"target"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>    cohortId <span class="op">=</span> <span class="st">"cohort_definition_id"</span>,</span>
<span>    cohortName <span class="op">=</span> <span class="st">"cohort_name"</span>,</span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">cohorts</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 8 × 3</span></span></span>
<span><span class="co">##   cohortId cohortName     type  </span></span>
<span><span class="co">##      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>        1 acetaminophen  event </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>        2 amoxicillin    event </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>        3 aspirin        event </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>        4 clavulanate    event </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>        5 death          exit  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>        6 doxylamine     event </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span>        7 penicillinv    event </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">8</span>        8 viralsinusitis target</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="database-interface">Database interface<a class="anchor" aria-label="anchor" href="#database-interface"></a>
</h2>
<p>TreatmentPatterns can connect to a database with either
<code>CDMConnector</code> using the <em>CDM-Reference</em> or with
<code>DatabaseConnector</code> using the <em>ConnectionDetails</em>. The
main difference between the two is that the connection to the database
is managed by TreatmentPatterns when using
<code>DatabaseConnector</code>. When using <code>CDMConnector</code>,
the connectoin is managed outside of TreatmentPatterns. Either case may
be useful depending on the environment TreatmentPatterns is run in.</p>
<p>It is worth noting that it does not matter how you create your
cohorts. You can use any means to generate a cohort table your heart
desires. You can use OHDSI tools like <strong>ATLAS</strong> or
<strong>Capr</strong> to specify cohort definitions. You can generate
them by executing the raw SQL from <strong>Circe</strong>, or generate
them with <code>CohortGenerator</code> or <code>CDMConnector</code>. The
only thing that matters is that the resulting cohort table:</p>
<table class="table">
<colgroup>
<col width="25%">
<col width="25%">
<col width="25%">
<col width="25%">
</colgroup>
<thead><tr class="header">
<th>cohort_definition_id</th>
<th>subject_id</th>
<th>cohort_start_date</th>
<th>cohort_end_date</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>2020-01-01</td>
<td>2020-12-31</td>
</tr>
<tr class="even">
<td>2</td>
<td>1</td>
<td>2020-02-04</td>
<td>2020-06-27</td>
</tr>
<tr class="odd">
<td>3</td>
<td>1</td>
<td>2020-07-03</td>
<td>2020-08-12</td>
</tr>
<tr class="even">
<td>4</td>
<td>1</td>
<td>2020-08-30</td>
<td>2020-11-29</td>
</tr>
<tr class="odd">
<td>1</td>
<td>2</td>
<td>2020-03-01</td>
<td>2020-10-30</td>
</tr>
<tr class="even">
<td>2</td>
<td>2</td>
<td>2020-05-04</td>
<td>2020-06-27</td>
</tr>
<tr class="odd">
<td>4</td>
<td>2</td>
<td>2020-10-03</td>
<td>2020-10-12</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="cdmconnector">CDMConnector<a class="anchor" aria-label="anchor" href="#cdmconnector"></a>
</h3>
<p>We can use <code>CDMConnector</code> to generate cohorts from JSON
definitions into the <em>cohrot_table</em> table in our database.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.duckdb.org/" class="external-link">duckdb</a></span><span class="op">)</span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span></span>
<span>  drv <span class="op">=</span> <span class="fu"><a href="https://r.duckdb.org/reference/duckdb.html" class="external-link">duckdb</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  dbdir <span class="op">=</span> <span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/eunomiaDir.html" class="external-link">eunomiaDir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Downloading GiBleed</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Download completed!</span></span></code></pre>
<pre><code><span><span class="co">## Creating CDM database /tmp/RtmpOqxCD6/file2e5c511d64cb/GiBleed_5.3.zip</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/cdmFromCon.html" class="external-link">cdmFromCon</a></span><span class="op">(</span></span>
<span>  con <span class="op">=</span> <span class="va">con</span>,</span>
<span>  cdmSchema <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>  writeSchema <span class="op">=</span> <span class="st">"main"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/generateCohortSet.html" class="external-link">generateCohortSet</a></span><span class="op">(</span></span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  cohortSet <span class="op">=</span> <span class="va">cohortSet</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"cohort_table"</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Generating 8 cohorts</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Generating cohort (1/8) - acetaminophen</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Generating cohort (1/8) - acetaminophen <span style="color: #B2B2B2;">[348ms]</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Generating cohort (2/8) - amoxicillin</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Generating cohort (2/8) - amoxicillin <span style="color: #B2B2B2;">[188ms]</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Generating cohort (3/8) - aspirin</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Generating cohort (3/8) - aspirin <span style="color: #B2B2B2;">[171ms]</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Generating cohort (4/8) - clavulanate</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Generating cohort (4/8) - clavulanate <span style="color: #B2B2B2;">[166ms]</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Generating cohort (5/8) - death</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Generating cohort (5/8) - death <span style="color: #B2B2B2;">[129ms]</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Generating cohort (6/8) - doxylamine</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Generating cohort (6/8) - doxylamine <span style="color: #B2B2B2;">[148ms]</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Generating cohort (7/8) - penicillinv</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Generating cohort (7/8) - penicillinv <span style="color: #B2B2B2;">[162ms]</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Generating cohort (8/8) - viralsinusitis</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> Generating cohort (8/8) - viralsinusitis <span style="color: #B2B2B2;">[231ms]</span></span></span></code></pre>
<p>Once we have our cohort generated, and our CDM-reference is setup, we
can simply pass the CDM-reference to <code><a href="../reference/computePathways.html">computePathways()</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outputEnv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computePathways.html">computePathways</a></span><span class="op">(</span></span>
<span>  cohorts <span class="op">=</span> <span class="va">cohorts</span>,</span>
<span>  cohortTableName <span class="op">=</span> <span class="st">"cohort_table"</span>,</span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="databaseconnector">DatabaseConnector<a class="anchor" aria-label="anchor" href="#databaseconnector"></a>
</h3>
<p>Similarly we can create <code>ConnectionDetails</code> to our
database:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ohdsi.github.io/DatabaseConnector/" class="external-link">DatabaseConnector</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">connectionDetails</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/createConnectionDetails.html" class="external-link">createConnectionDetails</a></span><span class="op">(</span></span>
<span>  dbms <span class="op">=</span> <span class="st">"postgres"</span>,</span>
<span>  user <span class="op">=</span> <span class="st">"user"</span>,</span>
<span>  password <span class="op">=</span> <span class="st">"password"</span>,</span>
<span>  server <span class="op">=</span> <span class="st">"some-server.database.net"</span>,</span>
<span>  port <span class="op">=</span> <span class="fl">1337</span>,</span>
<span>  pathToDriver <span class="op">=</span> <span class="st">"./path/to/jdbc/"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">outputEnv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computePathways.html">computePathways</a></span><span class="op">(</span></span>
<span>  cohorts <span class="op">=</span> <span class="va">cohorts</span>,</span>
<span>  cohortTableName <span class="op">=</span> <span class="st">"cohort_table"</span>,</span>
<span>  connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,</span>
<span>  cdmSchema <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>  resultSchema <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>  tempEmulationSchema <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span><span class="op">)</span></span></code></pre></div>
<p>We still have to specify the <code>cdmSchema</code>,
<code>resultSchema</code>, and <code>tempEmulationSchema</code> (when
applicable). For the CDM-Reference from <code>CDMConnector</code>, this
is handled outside of TreatmentPatterns.</p>
</div>
</div>
<div class="section level2">
<h2 id="analysis">Analysis<a class="anchor" aria-label="anchor" href="#analysis"></a>
</h2>
<p>We can specify some analysis identification parameters to keep track
of multiple analyses. This is particularly useful when uploading
multiple results to one database. We can use <code>analysisId</code> to
keep them seperate. We can also add a <code>description</code> to give
some context.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outputEnv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computePathways.html">computePathways</a></span><span class="op">(</span></span>
<span>  cohorts <span class="op">=</span> <span class="va">cohorts</span>,</span>
<span>  cohortTableName <span class="op">=</span> <span class="st">"cohort_table"</span>,</span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  analysisId <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"My First Treatment Patterns Analysis"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="events">Events<a class="anchor" aria-label="anchor" href="#events"></a>
</h2>
<p>TreatmentPatterns will build pathways from specified events. We have
control over how long these events should last, at minimum. We can do
this by setting the <code>minEraDuration</code>. Any event that lasts
shorter than the specified <code>minEraDuration</code> is not considered
as a valid event. We can also specify which events to consider for our
pathway by specifying a method in <code>filterTreatments</code>.
<code>"first"</code> only takes the first occurrence of each event.
<code>"All"</code> will consider all events and <code>"Changes"</code>
will only consider events that of which the next event is different than
itself.</p>
<p><img src="figures/a011_filterTreatments_first.png" id="id" class="class" style="width:30.0%"><img src="figures/a011_filterTreatments_changes.png" id="id" class="class" style="width:30.0%"><img src="figures/a011_filterTreatments_all.png" id="id" class="class" style="width:30.0%"></p>
<p>When we set <code>filterTreatments = "All"</code> we can additionally
collapse multiple occurring records of one event, into one record. The
<code>eraCollapseSize</code> specifies the gap that between two of the
same event that should be collapsed.</p>
<p><img src="figures/a011_filterTreatments_all_merge.png" id="id" class="class" style="width:50.0%"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/computePathways.html">computePathways</a></span><span class="op">(</span></span>
<span>  cohorts <span class="op">=</span> <span class="va">cohorts</span>,</span>
<span>  cohortTableName <span class="op">=</span> <span class="st">"cohort_table"</span>,</span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  minEraDuration <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  eraCollapseSize <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  filterTreatments <span class="op">=</span> <span class="st">"First"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="combinations">Combinations<a class="anchor" aria-label="anchor" href="#combinations"></a>
</h2>
<p>TreatmentPatterns can classify combination events within the supplied
events. It will look for overlap for all the occurring events. Not all
overlap is classified as a combination. This is dictated by the
<code>combinationWindow</code> parameter. This parameter specifies the
minimum duration of overlap between two events to classify as a
combination-event.</p>
<p><img src="figures/a05_combination_1.png" id="id" class="class" style="width:100.0%"></p>
<p>Effectively we split the two event records in three records: 1) Event
A, 2) Event B, and 3) The combination of event B and C.</p>
<p>The <code>minPostCombinationDuration</code> parameter dictates what
to do with the newly created events records. Because we could end up
with a remaining duration of Event A and Event B that will only last 1
day. <code>minPostCombinationDuration</code> dictates the minimum
duration of these newly created records, removing events that last
shorter then the specified time in days. It is therefore usually unwise
to specify the <code>minEraDuration</code> smaller than the
<code>combinationWindow</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/computePathways.html">computePathways</a></span><span class="op">(</span></span>
<span>  cohorts <span class="op">=</span> <span class="va">cohorts</span>,</span>
<span>  cohortTableName <span class="op">=</span> <span class="st">"cohort_table"</span>,</span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  combinationWindow <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  minPostCombinationDuration <span class="op">=</span> <span class="fl">30</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="non-significant-overlap">Non-Significant Overlap<a class="anchor" aria-label="anchor" href="#non-significant-overlap"></a>
</h3>
<p>Overlap is deemed not significant, the event transition is classified
as a <em>switch</em> of events. The first treatment is then trucated to
the index date of the overlapping event (in this case <strong>Event
B</strong>). If you’re only interrested in the final pathways that
TreatmentPatterns generates, this does not influence your resulting
pathways (barring some edge cases). However when you’d like to
investigate the patient-level records generated by
<code><a href="../reference/computePathways.html">computePathways()</a></code> this might lead to undesired end
dates.</p>
<p><img src="figures/a05_combination_2.png" id="id" class="class" style="width:100.0%"></p>
</div>
</div>
<div class="section level2">
<h2 id="overlap-method">Overlap Method<a class="anchor" aria-label="anchor" href="#overlap-method"></a>
</h2>
<p>The <code>overlapMethod</code> parameter allows you to specify what
method to use to deal with this non-significant overlap:
<code>"truncate"</code> to truncate the first event, as described
before:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outputEnv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computePathways.html">computePathways</a></span><span class="op">(</span></span>
<span>  cohorts <span class="op">=</span> <span class="va">cohorts</span>,</span>
<span>  cohortTableName <span class="op">=</span> <span class="st">"cohort_table"</span>,</span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  overlapMethod <span class="op">=</span> <span class="st">"truncate"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Or <code>"keep"</code>, to keep the start and end dates of both
records intact:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outputEnv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computePathways.html">computePathways</a></span><span class="op">(</span></span>
<span>  cohorts <span class="op">=</span> <span class="va">cohorts</span>,</span>
<span>  cohortTableName <span class="op">=</span> <span class="st">"cohort_table"</span>,</span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  overlapMethod <span class="op">=</span> <span class="st">"keep"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="acute-and-therapy-splits">Acute and Therapy Splits<a class="anchor" aria-label="anchor" href="#acute-and-therapy-splits"></a>
</h2>
<p>We can split specific events into <em>acute</em> and <em>therapy</em>
events. We do this by selecting our events of interest by
<code>cohort_definition_id</code> (or <code>cohortId</code>) in the
<code>splitEventCOhorts</code> parameter. We then set a cutoff for the
minimum amount of <strong>days</strong> we would like to classify as
<em>therapy</em> with <code>splitTime</code>. The first <em>n</em> days
will be classified as <em>acute</em> and remaining duration will be
classified as <em>therapy</em>.</p>
<p><img src="figures/a04_splitTime_1.png" id="id" class="class" style="width:100.0%"></p>
<p>Let’s say we want to assume that the first 60 days of our treatment
is acute, and beyond that therapy.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outputEnv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computePathways.html">computePathways</a></span><span class="op">(</span></span>
<span>  cohorts <span class="op">=</span> <span class="va">cohorts</span>,</span>
<span>  cohortTableName <span class="op">=</span> <span class="st">"cohort_table"</span>,</span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  splitEventCohorts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  splitTime <span class="op">=</span> <span class="fl">30</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/a04_splitTime_2.png" id="id" class="class" style="width:100.0%"></p>
</div>
<div class="section level2">
<h2 id="event-windows">Event Windows<a class="anchor" aria-label="anchor" href="#event-windows"></a>
</h2>
<div class="section level3">
<h3 id="anchoring">Anchoring<a class="anchor" aria-label="anchor" href="#anchoring"></a>
</h3>
<p>The <code><a href="../reference/computePathways.html">computePathways()</a></code> function has two ‘anchor’
arguments, <code>startAnchor</code> and <code>endAnchor</code>. These
arguments dictate what point to use as a reference. The two values that
you can set for both of these parameters are: <code>"startDate"</code>
and <code>"endDate"</code>, referencing the
<code>cohort_start_date</code> and <code>cohort_end_date</code> columns
in the cohort table. By default they are set to:
<code>startAnchor = "startDate"</code> and
<code>endAnchor = "endDate"</code></p>
</div>
<div class="section level3">
<h3 id="windowstart-and-windowend">windowStart and windowEnd<a class="anchor" aria-label="anchor" href="#windowstart-and-windowend"></a>
</h3>
<p>The <code>windowStart</code> and <code>windowEnd</code> parameters
dictate an offset from their corresponding <em>anchor</em>. If we
assuming the following parameters (defaults):</p>
<pre><code><span><span class="va">startAnchor</span> <span class="op">=</span> <span class="st">"startDate"</span></span>
<span><span class="va">windowStart</span> <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="va">endAnchor</span> <span class="op">=</span> <span class="st">"endDate"</span></span>
<span><span class="va">windowEnd</span> <span class="op">=</span> <span class="fl">0</span></span></code></pre>
<p>We will just use the <code>cohort_start_date</code> and
<code>cohort_end_date</code> as our window of interest.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outputEnv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computePathways.html">computePathways</a></span><span class="op">(</span></span>
<span>  cohorts <span class="op">=</span> <span class="va">cohorts</span>,</span>
<span>  cohortTableName <span class="op">=</span> <span class="st">"cohort_table"</span>,</span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  startAnchor <span class="op">=</span> <span class="st">"startDate"</span>,</span>
<span>  windowStart <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  endAnchor <span class="op">=</span> <span class="st">"endDate"</span>,</span>
<span>  windowEnd <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/a03_window_1.png"></p>
<p>We can extend our window with a 30 days on either side by altering
the <code>windowStart</code> and <code>windowEnd</code> variables:</p>
<pre><code><span><span class="va">startAnchor</span> <span class="op">=</span> <span class="st">"startDate"</span></span>
<span><span class="va">windowStart</span> <span class="op">=</span> <span class="op">-</span><span class="fl">30</span></span>
<span><span class="va">endAnchor</span> <span class="op">=</span> <span class="st">"endDate"</span></span>
<span><span class="va">windowEnd</span> <span class="op">=</span> <span class="fl">30</span></span></code></pre>
<p>Note that <code>windowStart = -30</code>, as in we subtract 30 days
from the <code>startAnchor</code>. <code>windowEnd = 30</code> as in we
add 30 days to the <code>endAnchor</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outputEnv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computePathways.html">computePathways</a></span><span class="op">(</span></span>
<span>  cohorts <span class="op">=</span> <span class="va">cohorts</span>,</span>
<span>  cohortTableName <span class="op">=</span> <span class="st">"cohort_table"</span>,</span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  startAnchor <span class="op">=</span> <span class="st">"startDate"</span>,</span>
<span>  windowStart <span class="op">=</span> <span class="op">-</span><span class="fl">30</span>,</span>
<span>  endAnchor <span class="op">=</span> <span class="st">"endDate"</span>,</span>
<span>  windowEnd <span class="op">=</span> <span class="fl">30</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/a03_window_2.png"></p>
</div>
<div class="section level3">
<h3 id="changing-the-anchoring">Changing the anchoring<a class="anchor" aria-label="anchor" href="#changing-the-anchoring"></a>
</h3>
<p>We can change the anchoring of <code>startAnchor</code> and
<code>endAnchor</code> to set our window to a period prior to the index
date:</p>
<pre><code><span><span class="va">startAnchor</span> <span class="op">=</span> <span class="st">"startDate"</span></span>
<span><span class="va">windowStart</span> <span class="op">=</span> <span class="op">-</span><span class="fl">30</span></span>
<span><span class="va">endAnchor</span> <span class="op">=</span> <span class="st">"startDate"</span></span>
<span><span class="va">windowEnd</span> <span class="op">=</span> <span class="fl">0</span></span></code></pre>
<p>Note that we set <strong>both</strong> the <code>startAnchor</code>
and <code>endAnchor</code> are set to <code>"startDate"</code>. So we
start -30 days from the index date, and end on the index date.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outputEnv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computePathways.html">computePathways</a></span><span class="op">(</span></span>
<span>  cohorts <span class="op">=</span> <span class="va">cohorts</span>,</span>
<span>  cohortTableName <span class="op">=</span> <span class="st">"cohort_table"</span>,</span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  startAnchor <span class="op">=</span> <span class="st">"startDate"</span>,</span>
<span>  windowStart <span class="op">=</span> <span class="op">-</span><span class="fl">30</span>,</span>
<span>  endAnchor <span class="op">=</span> <span class="st">"startDate"</span>,</span>
<span>  windowEnd <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/a03_window_3.png"> ## Pathways Finally we can
also dictate some parameters of the pathway. We can specify the maximum
length of the pathways with <code>maxPathLength</code>. This parameter
will truncate the pathways that exceed the set limit.</p>
<p>We can also set <code>concatTargets</code> to either
<code>TRUE</code> or <code>FALSE</code>. When set to <code>TRUE</code>
it will append multiple cases, which might be useful for time invariant
target cohorts like chronic conditions. If you would like to evaluate
each occurrence of a target cohort seperately, we can set it to
<code>FALSE</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="running-the-analysis">Running the analysis<a class="anchor" aria-label="anchor" href="#running-the-analysis"></a>
</h2>
<p>After careful consideration of the settings, we can run our Treatment
Patterns analysis:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/darwin-eu/TreatmentPatterns" class="external-link">TreatmentPatterns</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Computing pathways</span></span>
<span><span class="va">outputEnv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computePathways.html">computePathways</a></span><span class="op">(</span></span>
<span>  cohorts <span class="op">=</span> <span class="va">cohorts</span>,</span>
<span>  cohortTableName <span class="op">=</span> <span class="st">"cohort_table"</span>,</span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  analysisId <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"My Treatment Pathway analysis"</span>,</span>
<span></span>
<span>  <span class="co"># Window</span></span>
<span>  startAnchor <span class="op">=</span> <span class="st">"startDate"</span>,</span>
<span>  windowStart <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  endAnchor <span class="op">=</span> <span class="st">"endDate"</span>,</span>
<span>  windowEnd <span class="op">=</span> <span class="fl">0</span>,</span>
<span></span>
<span>  <span class="co"># Acute / Therapy</span></span>
<span>  splitEventCohorts <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  splitTime <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span></span>
<span>  <span class="co"># Events</span></span>
<span>  minEraDuration <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  filterTreatments <span class="op">=</span> <span class="st">"All"</span>,</span>
<span>  eraCollapseSize <span class="op">=</span> <span class="fl">3</span>,</span>
<span></span>
<span>  <span class="co"># Combinations</span></span>
<span>  combinationWindow <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  minPostCombinationDuration <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  overlapMethod <span class="op">=</span> <span class="st">"truncate"</span>,</span>
<span></span>
<span>  <span class="co"># Pathways</span></span>
<span>  maxPathLength <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  concatTargets <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## -- Qualifying records for cohort definitions: 1, 2, 3, 4, 5, 6, 7, 8</span></span>
<span><span class="co">##  Records: 14041</span></span>
<span><span class="co">##  Subjects: 2693</span></span></code></pre>
<pre><code><span><span class="co">## -- Removing records &lt; minEraDuration (7)</span></span>
<span><span class="co">##  Records: 11347</span></span>
<span><span class="co">##  Subjects: 2159</span></span></code></pre>
<pre><code><span><span class="co">## &gt;&gt; Starting on target: 8 (viralsinusitis)</span></span></code></pre>
<pre><code><span><span class="co">## -- Removing events outside window (startDate: 0 | endDate: 0)</span></span>
<span><span class="co">##  Records: 8327</span></span>
<span><span class="co">##  Subjects: 2142</span></span></code></pre>
<pre><code><span><span class="co">## -- splitEventCohorts</span></span>
<span><span class="co">##  Records: 8327</span></span>
<span><span class="co">##  Subjects: 2142</span></span></code></pre>
<pre><code><span><span class="co">## -- Collapsing eras, eraCollapse (3)</span></span>
<span><span class="co">##  Records: 8327</span></span>
<span><span class="co">##  Subjects: 2142</span></span></code></pre>
<pre><code><span><span class="co">## -- Iteration 1: minPostCombinationDuration (7), combinatinoWindow (7)</span></span>
<span><span class="co">##  Records: 6799</span></span>
<span><span class="co">##  Subjects: 2142</span></span></code></pre>
<pre><code><span><span class="co">## -- Iteration 2: minPostCombinationDuration (7), combinatinoWindow (7)</span></span>
<span><span class="co">##  Records: 6663</span></span>
<span><span class="co">##  Subjects: 2142</span></span></code></pre>
<pre><code><span><span class="co">## -- Iteration 3: minPostCombinationDuration (7), combinatinoWindow (7)</span></span>
<span><span class="co">##  Records: 6662</span></span>
<span><span class="co">##  Subjects: 2142</span></span></code></pre>
<pre><code><span><span class="co">## -- After Combination</span></span>
<span><span class="co">##  Records: 6662</span></span>
<span><span class="co">##  Subjects: 2142</span></span></code></pre>
<pre><code><span><span class="co">## -- filterTreatments (All)</span></span>
<span><span class="co">##  Records: 6662</span></span>
<span><span class="co">##  Subjects: 2142</span></span></code></pre>
<pre><code><span><span class="co">## -- Max path length (10)</span></span>
<span><span class="co">##  Records: 6662</span></span>
<span><span class="co">##  Subjects: 2142</span></span></code></pre>
<pre><code><span><span class="co">## -- treatment construction done</span></span>
<span><span class="co">##  Records: 6662</span></span>
<span><span class="co">##  Subjects: 2142</span></span></code></pre>
<p>The result is an <code>Andromeda</code> object that contains
patient-level data. We will go into exporting the results to share-able
files in the <strong>Exporting</strong> vignette.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Aniek Markus, Maarten van Kessel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
