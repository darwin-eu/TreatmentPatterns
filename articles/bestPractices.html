<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Best practices • TreatmentPatterns</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Best practices">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">TreatmentPatterns</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/bestPractices.html">Best practices</a></li>
    <li><a class="dropdown-item" href="../articles/ComputingTreatmentPathways.html">Computing Treatment Pathways</a></li>
    <li><a class="dropdown-item" href="../articles/DefiningCohorts.html">Defining Cohorts</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/darwin-eu/TreatmentPatterns/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="bestPractices_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="bestPractices_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="bestPractices_files/viz-1.8.2/viz.js"></script><link href="bestPractices_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="bestPractices_files/grViz-binding-1.0.11/grViz.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Best practices</h1>
                        <h4 data-toc-skip class="author">Maarten van
Kessel</h4>
            
            <h4 data-toc-skip class="date">2025-03-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/darwin-eu/TreatmentPatterns/blob/v3.0.1/vignettes/articles/bestPractices.Rmd" class="external-link"><code>vignettes/articles/bestPractices.Rmd</code></a></small>
      <div class="d-none name"><code>bestPractices.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>There are some rules of thumb that I follow when using the
<code>TreatmentPatterns</code> package. These rules tend to work well in
most situations, across databases and datasets.</p>
<div class="section level3">
<h3 id="tldr">TLDR<a class="anchor" aria-label="anchor" href="#tldr"></a>
</h3>
<ul>
<li>
<code>minPostCombinationWindow &lt;= minEraDuration</code>.</li>
<li>
<code>combinationWindow &gt;= minEraDuration</code>.</li>
<li>Small cohorts should not be considered.</li>
<li>Pathways with a low count should not be considered.</li>
<li>Possible number of pathways:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>n</mi><mi>n</mi></msup><annotation encoding="application/x-tex">n^n</annotation></semantics></math>
</li>
<li>Possible number of pathways, with no re-occurrence:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>!</mi></mrow><annotation encoding="application/x-tex">n!</annotation></semantics></math>
</li>
<li>Total number of possible events (events + combinations):
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2^n - 1</annotation></semantics></math>
</li>
<li>Total number of possible combinations:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup><mo>−</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>n</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">2^n - (n + 1)</annotation></semantics></math>
</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="cohorts">Cohorts<a class="anchor" aria-label="anchor" href="#cohorts"></a>
</h2>
<p>When creating cohorts, it is important to keep in mind that the
subjects will be dived across pathways. Lets assume we have 10000
subjects in a fictitious cohort. Let’s also assume we have 5 event
cohorts.</p>
<p>The total number of potential pathways, assuming only mono therapies
equals to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>a</mi><mi>t</mi><mi>h</mi><mi>w</mi><mi>a</mi><mi>y</mi><msub><mi>s</mi><mi>n</mi></msub><mo>=</mo><msup><mi>n</mi><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">pathways_n = n^{n}</annotation></semantics></math>,
assuming we do not allow for any re-occurring treatments it would still
equal to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>a</mi><mi>t</mi><mi>h</mi><mi>w</mi><mi>a</mi><mi>y</mi><msub><mi>s</mi><mi>n</mi></msub><mo>=</mo><mi>n</mi><mi>!</mi></mrow><annotation encoding="application/x-tex">pathways_n = n!</annotation></semantics></math>.</p>
<p>Assuming our 5 event cohorts this would equal to:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">5</span><span class="op">^</span><span class="fl">5</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 3125</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Special.html" class="external-link">factorial</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 120</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="combinations">Combinations<a class="anchor" aria-label="anchor" href="#combinations"></a>
</h2>
<p>Combinations add additional pathway possibilities. Each event can be
uniquely combined with each other event. Each combination can combine
with another singular event or any other combination. However, each
event in a combination must be unique. So:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>B</mi><mo>=</mo><mi>B</mi><mi>A</mi></mrow><annotation encoding="application/x-tex">AB = BA</annotation></semantics></math>.
As an example it is irrelevant if a person receives penicillin and
ibuprofen or ibuprofen and penicillin.</p>
<p>We can draw out all possible combinations in a graph for events
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>B</mi><annotation encoding="application/x-tex">B</annotation></semantics></math><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>C</mi><annotation encoding="application/x-tex">C</annotation></semantics></math>.</p>
<div class="grViz html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"diagram":"digraph {\n  graph [layout = dot, rankdir = TB, splines = line]\n  \n  A [label = <A<FONT POINT-SIZE=\"8\"><SUB>1<\/SUB><\/FONT>>]\n  B [label = <B<FONT POINT-SIZE=\"8\"><SUB>1<\/SUB><\/FONT>>]\n  C [label = <C<FONT POINT-SIZE=\"8\"><SUB>1<\/SUB><\/FONT>>]\n  D [label = <D<FONT POINT-SIZE=\"8\"><SUB>1<\/SUB><\/FONT>>]\n  \n  AB [label = <AB<FONT POINT-SIZE=\"8\"><SUB>2<\/SUB><\/FONT>>]\n  AC [label = <AC<FONT POINT-SIZE=\"8\"><SUB>2<\/SUB><\/FONT>>]\n  AD [label = <AD<FONT POINT-SIZE=\"8\"><SUB>2<\/SUB><\/FONT>>]\n  BC [label = <BC<FONT POINT-SIZE=\"8\"><SUB>2<\/SUB><\/FONT>>]\n  BD [label = <BD<FONT POINT-SIZE=\"8\"><SUB>2<\/SUB><\/FONT>>]\n  CD [label = <CD<FONT POINT-SIZE=\"8\"><SUB>2<\/SUB><\/FONT>>]\n  \n  ABC [label = <ABC<FONT POINT-SIZE=\"8\"><SUB>3<\/SUB><\/FONT>>]\n  ABD [label = <ABD<FONT POINT-SIZE=\"8\"><SUB>3<\/SUB><\/FONT>>]\n  ACD [label = <ACD<FONT POINT-SIZE=\"8\"><SUB>3<\/SUB><\/FONT>>]\n  BCD [label = <BCD<FONT POINT-SIZE=\"8\"><SUB>3<\/SUB><\/FONT>>]\n  \n  ABCD [label = <ABCD<FONT POINT-SIZE=\"8\"><SUB>4<\/SUB><\/FONT>>]\n  \n  subgraph cluster1 {\n    A -> AB -> ABC -> ABCD\n         AB -> ABD\n    A -> AC\n         AC -> ACD\n    A -> AD\n  }\n  \n  subgraph cluster2 {\n    B -> BC -> BCD\n    B -> BD\n  }\n  \n  subgraph cluster3 {\n    C -> CD\n  }\n  \n  subgraph cluster4 {\n    D\n  }\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>The subscript of the nodes are the layers where the combination
exists in. I.e. combination
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>B</mi></mrow><annotation encoding="application/x-tex">AB</annotation></semantics></math>
is in layer 2, and combinations
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>B</mi><mi>C</mi><mi>D</mi></mrow><annotation encoding="application/x-tex">ABCD</annotation></semantics></math>
is in layer 4. The layer coincides with the number of events in the
combination.</p>
<p>We can count the number of nodes per layer, for each graph:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="center" style="text-align: center"></mtd><mtd columnalign="center" style="text-align: center"><mi>l</mi><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mi>l</mi><mn>2</mn></mtd><mtd columnalign="center" style="text-align: center"><mi>l</mi><mn>3</mn></mtd><mtd columnalign="center" style="text-align: center"><mi>l</mi><mn>4</mn></mtd><mtd columnalign="center" style="text-align: center"><mi>s</mi><mi>u</mi><mi>m</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>A</mi></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>3</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>3</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>8</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>B</mi></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>2</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>4</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>C</mi></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>2</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>D</mi></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>0</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{matrix}
  &amp; l1 &amp; l2 &amp; l3 &amp; l4 &amp; sum\\
A &amp;  1 &amp;  3 &amp;  3 &amp;  1 &amp; 8\\
B &amp;  1 &amp;  2 &amp;  1 &amp;  0 &amp; 4\\
C &amp;  1 &amp;  1 &amp;  0 &amp;  0 &amp; 2\\
D &amp;  1 &amp;  0 &amp;  0 &amp;  0 &amp; 1
\end{matrix}
</annotation></semantics></math></p>
<p>Our sums look suspiciously similar to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mn>2</mn><mi>n</mi></msup><annotation encoding="application/x-tex">2^n</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">2</span><span class="op">^</span><span class="fl">1</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">2</span><span class="op">^</span><span class="fl">2</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 4</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">2</span><span class="op">^</span><span class="fl">3</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 8</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">2</span><span class="op">^</span><span class="fl">4</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 16</span></span></code></pre>
<p>We seem to overshoot by 1
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>,
so we can try
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup><annotation encoding="application/x-tex">2^{n-1}</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">2</span><span class="op">^</span><span class="fl">0</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">2</span><span class="op">^</span><span class="fl">1</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">2</span><span class="op">^</span><span class="fl">2</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 4</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">2</span><span class="op">^</span><span class="fl">3</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 8</span></span></code></pre>
<p>So our total number of events equals:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></munderover><msup><mn>2</mn><mi>i</mi></msup></mrow><annotation encoding="application/x-tex">
\sum^{n-1}_{i=0}2^{i}
</annotation></semantics></math></p>
<p>Which we can define as a function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>f</mi><mn>1</mn></msub><annotation encoding="application/x-tex">f_1</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">^</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">^</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">^</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">^</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 15</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Or:</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fl">2</span><span class="op">^</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">n</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 15</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f_1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fl">2</span><span class="op">^</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">n</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We can simulate our
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>f</mi><mn>1</mn></msub><annotation encoding="application/x-tex">f_1</annotation></semantics></math>
function for 100 events.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">25</span></span>
<span><span class="va">f_1_events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">f_1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="va">n</span>,</span>
<span>  f_1 <span class="op">=</span> <span class="va">f_1_events</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     n      f_1</span></span>
<span><span class="co">## 1   1        1</span></span>
<span><span class="co">## 2   2        3</span></span>
<span><span class="co">## 3   3        7</span></span>
<span><span class="co">## 4   4       15</span></span>
<span><span class="co">## 5   5       31</span></span>
<span><span class="co">## 6   6       63</span></span>
<span><span class="co">## 7   7      127</span></span>
<span><span class="co">## 8   8      255</span></span>
<span><span class="co">## 9   9      511</span></span>
<span><span class="co">## 10 10     1023</span></span>
<span><span class="co">## 11 11     2047</span></span>
<span><span class="co">## 12 12     4095</span></span>
<span><span class="co">## 13 13     8191</span></span>
<span><span class="co">## 14 14    16383</span></span>
<span><span class="co">## 15 15    32767</span></span>
<span><span class="co">## 16 16    65535</span></span>
<span><span class="co">## 17 17   131071</span></span>
<span><span class="co">## 18 18   262143</span></span>
<span><span class="co">## 19 19   524287</span></span>
<span><span class="co">## 20 20  1048575</span></span>
<span><span class="co">## 21 21  2097151</span></span>
<span><span class="co">## 22 22  4194303</span></span>
<span><span class="co">## 23 23  8388607</span></span>
<span><span class="co">## 24 24 16777215</span></span>
<span><span class="co">## 25 25 33554431</span></span></code></pre>
<p>Notice how the number of events increases with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2^n-1</annotation></semantics></math>.</p>
<p>We define this as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>f</mi><mn>2</mn></msub><annotation encoding="application/x-tex">f_2</annotation></semantics></math>.
We can compare
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>f</mi><mn>1</mn></msub><annotation encoding="application/x-tex">f_1</annotation></semantics></math>
to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>f</mi><mn>2</mn></msub><annotation encoding="application/x-tex">f_2</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f_2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fl">2</span><span class="op">^</span><span class="va">n</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">25</span></span>
<span><span class="va">f_1_events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">f_1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">f_2_events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">f_2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="va">n</span>,</span>
<span>  f_1 <span class="op">=</span> <span class="va">f_1_events</span>,</span>
<span>  f_2 <span class="op">=</span> <span class="va">f_2_events</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     n      f_1      f_2</span></span>
<span><span class="co">## 1   1        1        1</span></span>
<span><span class="co">## 2   2        3        3</span></span>
<span><span class="co">## 3   3        7        7</span></span>
<span><span class="co">## 4   4       15       15</span></span>
<span><span class="co">## 5   5       31       31</span></span>
<span><span class="co">## 6   6       63       63</span></span>
<span><span class="co">## 7   7      127      127</span></span>
<span><span class="co">## 8   8      255      255</span></span>
<span><span class="co">## 9   9      511      511</span></span>
<span><span class="co">## 10 10     1023     1023</span></span>
<span><span class="co">## 11 11     2047     2047</span></span>
<span><span class="co">## 12 12     4095     4095</span></span>
<span><span class="co">## 13 13     8191     8191</span></span>
<span><span class="co">## 14 14    16383    16383</span></span>
<span><span class="co">## 15 15    32767    32767</span></span>
<span><span class="co">## 16 16    65535    65535</span></span>
<span><span class="co">## 17 17   131071   131071</span></span>
<span><span class="co">## 18 18   262143   262143</span></span>
<span><span class="co">## 19 19   524287   524287</span></span>
<span><span class="co">## 20 20  1048575  1048575</span></span>
<span><span class="co">## 21 21  2097151  2097151</span></span>
<span><span class="co">## 22 22  4194303  4194303</span></span>
<span><span class="co">## 23 23  8388607  8388607</span></span>
<span><span class="co">## 24 24 16777215 16777215</span></span>
<span><span class="co">## 25 25 33554431 33554431</span></span></code></pre>
<p>Now we can assert the following: <span class="math display">$$
monoEvents = n
\\
totalEvents = 2^n - 1
\\
combinationEvents = totalEvents - n
$$</span></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">totalEvents</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">^</span><span class="va">n</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="va">combinationEvents</span> <span class="op">&lt;-</span> <span class="va">totalEvents</span> <span class="op">-</span> <span class="va">n</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"monoEvents: %s"</span>, <span class="va">n</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "monoEvents: 5"</span></span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"totalEvents: %s"</span>, <span class="va">totalEvents</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "totalEvents: 31"</span></span></code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"combinationEvents: %s"</span>, <span class="va">combinationEvents</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "combinationEvents: 26"</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="settings">Settings<a class="anchor" aria-label="anchor" href="#settings"></a>
</h2>
<p>The <code>minEraDuration</code>, <code>combinationWindow</code>, and
<code>minPostCombinationWindow</code> have significant effects on how
the treatment pathways are built. Conciser the following example:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">cohort_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">cohort_definition_id</span>, <span class="op">~</span><span class="va">subject_id</span>, <span class="op">~</span><span class="va">cohort_start_date</span>,    <span class="op">~</span><span class="va">cohort_end_date</span>,</span>
<span>  <span class="fl">1</span>,                     <span class="fl">1</span>,           <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-01-01"</span><span class="op">)</span>,</span>
<span>  <span class="fl">2</span>,                     <span class="fl">1</span>,           <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-01-20"</span><span class="op">)</span>,</span>
<span>  <span class="fl">3</span>,                     <span class="fl">1</span>,           <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-01-22"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-02-28"</span><span class="op">)</span>,</span>
<span>  <span class="fl">4</span>,                     <span class="fl">1</span>,           <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-02-20"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-03-3"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cohort_table</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 4 × 4</span></span></span>
<span><span class="co">##   cohort_definition_id subject_id cohort_start_date cohort_end_date</span></span>
<span><span class="co">##                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>                    1          1 2020-01-01        2021-01-01     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>                    2          1 2020-01-01        2020-01-20     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>                    3          1 2020-01-22        2020-02-28     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>                    4          1 2020-02-20        2020-03-03</span></span></code></pre>
<p>Assume that the target cohort is cohort_definition_id: 1, the rest
are event cohorts.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cohort_table</span> <span class="op">&lt;-</span> <span class="va">cohort_table</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>duration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">cohort_end_date</span> <span class="op">-</span> <span class="va">cohort_start_date</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cohort_table</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 4 × 5</span></span></span>
<span><span class="co">##   cohort_definition_id subject_id cohort_start_date cohort_end_date duration</span></span>
<span><span class="co">##                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>                    1          1 2020-01-01        2021-01-01           366</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>                    2          1 2020-01-01        2020-01-20            19</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>                    3          1 2020-01-22        2020-02-28            37</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>                    4          1 2020-02-20        2020-03-03            12</span></span></code></pre>
<p>As you can see, the duration of the treatments are: 19, 37 and 12
days. Also cohort 3 overlaps with treatment 4 for 8 days.</p>
<p>We can compute the overlap as follows:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cohort_table</span> <span class="op">&lt;-</span> <span class="va">cohort_table</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Filter out target cohort</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohort_definition_id</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>overlap <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="co"># If the result of the next cohort_end_date is NA, set 0</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lead</a></span><span class="op">(</span><span class="va">cohort_end_date</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="fl">0</span>,</span>
<span>    <span class="co"># Compute duration of cohort_end_date - next cohort_start_date</span></span>
<span>    <span class="co"># 2020-02-28 - 2020-02-20 = -8</span></span>
<span>    .default <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">cohort_end_date</span> <span class="op">-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lead</a></span><span class="op">(</span><span class="va">cohort_start_date</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cohort_table</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 6</span></span></span>
<span><span class="co">##   cohort_definition_id subject_id cohort_start_date cohort_end_date duration</span></span>
<span><span class="co">##                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>                    2          1 2020-01-01        2020-01-20            19</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>                    3          1 2020-01-22        2020-02-28            37</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>                    4          1 2020-02-20        2020-03-03            12</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 1 more variable: overlap &lt;dbl&gt;</span></span></span></code></pre>
<p>We see that the overlap between treatment 2 and 3 is <code>-2</code>,
so rather than an overlap there is a gap between these treatments.
Between treatment 3 and 4 there is an 8 day overlap. There is no next
treatment after treatment 4, so the overlap is 0, let’s assume our
<code>minEraDuration = 5</code>.</p>
<p>We can draw it out like so:</p>
<pre><code>2:   -------------------
3:                        -------------------------------------
4:                                                     ------------</code></pre>
<p>If we set our <code>minCombinationWindow = 5</code>, the combination
would be computed for cohort 3 and 4. This would leave us with the
following treatments:</p>
<pre><code>2:   -------------------
3:                        -----------------------------
3+4:                                                   --------
4:                                                             ----</code></pre>
<p>Treatment 3 now lasts 11 days; Treatment 4 lasts 4 days; and
combination treatment 3+4 lasts 8 days. If our
<code>minPostCombinationDuration</code> is not set properly, we can
filter out either too many, or too little treatments.</p>
<p>Assuming we would set <code>minPostCombinationDuration = 10</code>,
we would lose treatment 4 and combination treatment 3+4. This would
leave us with the following paths:</p>
<pre><code><span><span class="fl">2</span><span class="op">:</span>   <span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span></span>
<span><span class="fl">3</span><span class="op">:</span>                        <span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span></span>
<span></span>
<span><span class="va">Pathway</span><span class="op">:</span> <span class="fl">2</span><span class="op">-</span><span class="fl">3</span></span></code></pre>
<p>As a rule of thumb the setting the
<code>minPostCombinationDuration &lt;= minEraDuration</code> seems to
yield reasonable results. This would leave us with the following paths
<code>minPostCombinationDuration = 5</code>:</p>
<pre><code><span><span class="fl">2</span><span class="op">:</span>   <span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span></span>
<span><span class="fl">3</span><span class="op">:</span>                        <span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span></span>
<span><span class="fl">3</span><span class="op">+</span><span class="fl">4</span><span class="op">:</span>                                                   <span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span><span class="op">-</span></span>
<span></span>
<span><span class="va">Pathway</span><span class="op">:</span> <span class="fl">2</span><span class="op">-</span><span class="fl">3</span><span class="op">-</span><span class="fl">3</span><span class="op">+</span><span class="fl">4</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Aniek Markus, Maarten van Kessel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
