<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Computing Treatment Pathways • TreatmentPatterns</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Computing Treatment Pathways">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">TreatmentPatterns</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/bestPractices.html">Best practices</a></li>
    <li><a class="dropdown-item" href="../articles/ComputingTreatmentPathways.html">Computing Treatment Pathways</a></li>
    <li><a class="dropdown-item" href="../articles/DefiningCohorts.html">Defining Cohorts</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/darwin-eu/TreatmentPatterns/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="ComputingTreatmentPathways_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="ComputingTreatmentPathways_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="ComputingTreatmentPathways_files/sequences-0.1/sequences.css" rel="stylesheet">
<script src="ComputingTreatmentPathways_files/sunburst-binding-2.1.8/sunburst.js"></script><script src="ComputingTreatmentPathways_files/d3-4.9.1/d3.min.js"></script><script src="ComputingTreatmentPathways_files/sankey-1/sankey.js"></script><script src="ComputingTreatmentPathways_files/sankeyNetwork-binding-0.4.1/sankeyNetwork.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Computing Treatment Pathways</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/darwin-eu/TreatmentPatterns/blob/main/vignettes/articles/ComputingTreatmentPathways.Rmd" class="external-link"><code>vignettes/articles/ComputingTreatmentPathways.Rmd</code></a></small>
      <div class="d-none name"><code>ComputingTreatmentPathways.Rmd</code></div>
    </div>

    
    
<p>In <strong>1. Defining Cohorts</strong> we discussed how to define
and generate cohorts for <code>TreatmentPatterns</code>. In this section
we assume you are able to generate a cohort table using either
<code>CohortGenerator</code> or <code>CDMConnector</code>.</p>
<p>Lets generate our Viral Sinusitis dummy cohorts provided in
<code>TreatmentPatterns</code> using <code>CDMConnector</code>.</p>
<div class="section level2">
<h2 id="generating-cohorts">Generating Cohorts<a class="anchor" aria-label="anchor" href="#generating-cohorts"></a>
</h2>
<p>First we need to read in our cohorts.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu.github.io/CDMConnector/" class="external-link">CDMConnector</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">cohortSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/readCohortSet.html" class="external-link">readCohortSet</a></span><span class="op">(</span></span>
<span>  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"TreatmentPatterns"</span>, <span class="st">"exampleCohorts"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cohortSet</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 8 × 5</span></span></span>
<span><span class="co">##   cohort_definition_id cohort_name    cohort       json   cohort_name_snakecase</span></span>
<span><span class="co">##                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>                    1 acetaminophen  <span style="color: #949494;">&lt;named list&gt;</span> <span style="color: #949494;">&lt;chr&gt;</span>  acetaminophen        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>                    2 amoxicillin    <span style="color: #949494;">&lt;named list&gt;</span> <span style="color: #949494;">&lt;chr&gt;</span>  amoxicillin          </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>                    3 aspirin        <span style="color: #949494;">&lt;named list&gt;</span> <span style="color: #949494;">&lt;chr&gt;</span>  aspirin              </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>                    4 clavulanate    <span style="color: #949494;">&lt;named list&gt;</span> <span style="color: #949494;">&lt;chr&gt;</span>  clavulanate          </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>                    5 death          <span style="color: #949494;">&lt;named list&gt;</span> <span style="color: #949494;">&lt;chr&gt;</span>  death                </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>                    6 doxylamine     <span style="color: #949494;">&lt;named list&gt;</span> <span style="color: #949494;">&lt;chr&gt;</span>  doxylamine           </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span>                    7 penicillinv    <span style="color: #949494;">&lt;named list&gt;</span> <span style="color: #949494;">&lt;chr&gt;</span>  penicillinv          </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">8</span>                    8 viralsinusitis <span style="color: #949494;">&lt;named list&gt;</span> <span style="color: #949494;">&lt;chr&gt;</span>  viralsinusitis</span></span></code></pre>
<p>Then we can open a connection to our database, in this case
Eunomia.</p>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'Eunomia'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:CDMConnector':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     downloadEunomiaData</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Download completed!</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span></span>
<span>  drv <span class="op">=</span> <span class="fu">duckdb</span><span class="fu">::</span><span class="fu"><a href="https://r.duckdb.org/reference/duckdb.html" class="external-link">duckdb</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  dbdir <span class="op">=</span> <span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/eunomiaDir.html" class="external-link">eunomiaDir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Creating CDM database /tmp/RtmpRnHkiA/file2e463824787a/GiBleed_5.3.zip</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/cdmFromCon.html" class="external-link">cdmFromCon</a></span><span class="op">(</span></span>
<span>  con <span class="op">=</span> <span class="va">con</span>,</span>
<span>  cdmSchema <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>  writeSchema <span class="op">=</span> <span class="st">"main"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">cdm</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;"># OMOP CDM reference (duckdb) of Synthea</span> <span style="color: #00BBBB;">────────────────────────────────────</span></span></span>
<span><span class="co">## • <span style="font-weight: bold;">omop tables:</span> person, observation_period, visit_occurrence, visit_detail,</span></span>
<span><span class="co">## condition_occurrence, drug_exposure, procedure_occurrence, device_exposure,</span></span>
<span><span class="co">## measurement, observation, death, note, note_nlp, specimen, fact_relationship,</span></span>
<span><span class="co">## location, care_site, provider, payer_plan_period, cost, drug_era, dose_era,</span></span>
<span><span class="co">## condition_era, metadata, cdm_source, concept, vocabulary, domain,</span></span>
<span><span class="co">## concept_class, concept_relationship, relationship, concept_synonym,</span></span>
<span><span class="co">## concept_ancestor, source_to_concept_map, drug_strength</span></span>
<span><span class="co">## • <span style="font-weight: bold;">cohort tables:</span> -</span></span>
<span><span class="co">## • <span style="font-weight: bold;">achilles tables:</span> -</span></span>
<span><span class="co">## • <span style="font-weight: bold;">other tables:</span> -</span></span></code></pre>
<p>Finally we can generate our cohort set as a cohort table into the
database</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/generateCohortSet.html" class="external-link">generateCohortSet</a></span><span class="op">(</span></span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  cohortSet <span class="op">=</span> <span class="va">cohortSet</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"cohort_table"</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Generating 8 cohorts</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Generating cohort (1/8) - acetaminophen</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Generating cohort (1/8) - acetaminophen <span style="color: #B2B2B2;">[389ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Generating cohort (2/8) - amoxicillin</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Generating cohort (2/8) - amoxicillin <span style="color: #B2B2B2;">[224ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Generating cohort (3/8) - aspirin</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Generating cohort (3/8) - aspirin <span style="color: #B2B2B2;">[173ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Generating cohort (4/8) - clavulanate</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Generating cohort (4/8) - clavulanate <span style="color: #B2B2B2;">[160ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Generating cohort (5/8) - death</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Generating cohort (5/8) - death <span style="color: #B2B2B2;">[134ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Generating cohort (6/8) - doxylamine</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Generating cohort (6/8) - doxylamine <span style="color: #B2B2B2;">[156ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Generating cohort (7/8) - penicillinv</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Generating cohort (7/8) - penicillinv <span style="color: #B2B2B2;">[157ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Generating cohort (8/8) - viralsinusitis</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> Generating cohort (8/8) - viralsinusitis <span style="color: #B2B2B2;">[246ms]</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span></code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://darwin-eu.github.io/omopgenerics/reference/cohortCount.html" class="external-link">cohortCount</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort_table</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 8 × 3</span></span></span>
<span><span class="co">##   cohort_definition_id number_records number_subjects</span></span>
<span><span class="co">##                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>                    1           <span style="text-decoration: underline;">2</span>679            <span style="text-decoration: underline;">2</span>679</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>                    2           <span style="text-decoration: underline;">2</span>130            <span style="text-decoration: underline;">2</span>130</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>                    3           <span style="text-decoration: underline;">1</span>927            <span style="text-decoration: underline;">1</span>927</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>                    4           <span style="text-decoration: underline;">2</span>021            <span style="text-decoration: underline;">2</span>021</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>                    5              0               0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>                    6           <span style="text-decoration: underline;">1</span>393            <span style="text-decoration: underline;">1</span>393</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span>                    7           <span style="text-decoration: underline;">1</span>732            <span style="text-decoration: underline;">1</span>732</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">8</span>                    8           <span style="text-decoration: underline;">2</span>159            <span style="text-decoration: underline;">2</span>159</span></span></code></pre>
<p>We can see that all our cohorts are generated in the cohort table.
The cohort with <em>cohort_definition_id</em> 5 has a count of 0, this
is the <em>Death</em> cohort. This is not detrimental, as exit cohorts
are optional, but good to know that Death will not show up in our
results.</p>
</div>
<div class="section level2">
<h2 id="computing-pathways">Computing pathways<a class="anchor" aria-label="anchor" href="#computing-pathways"></a>
</h2>
<p>The <code>computePathways</code> function of
<code>TreatmentPatterns</code> allows us to compute treatment pathways
in our cohort table. In order to do this we need to pre-specify some
parameters.</p>
<p>According to the documentation we need a <code>data.frame</code> that
specifies what cohort is of which type.</p>
<blockquote>
<p>Data frame containing the following columns and data types:</p>
<p>cohortId numeric(1) Cohort ID’s of the cohorts to be used in the
cohort table.</p>
<p>cohortName character(1) Cohort names of the cohorts to be used in the
cohort table.</p>
<p>type character(1) [“target”, “event’,”exit”] Cohort type, describing
if the cohort is a target, event, or exit cohort</p>
</blockquote>
<p>We are able to re-use our <code>cohortSet</code> for this. As it
already contains the cohort ID’s and cohort names. We only have to
remove the <code>cohort</code> and <code>json</code> columns, add a
<code>type</code> column, and rename <code>cohort_definition_id</code>
to <code>cohortId</code> and <code>cohort_name</code> to
<code>cohortName</code>.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">cohorts</span> <span class="op">&lt;-</span> <span class="va">cohortSet</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Remove 'cohort' and 'json' columns</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="st">"cohort"</span>, <span class="op">-</span><span class="st">"json"</span>, <span class="op">-</span><span class="st">"cohort_name_snakecase"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"event"</span>, <span class="st">"event"</span>, <span class="st">"event"</span>, <span class="st">"event"</span>, <span class="st">"exit"</span>, <span class="st">"event"</span>, <span class="st">"event"</span>, <span class="st">"target"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>    cohortId <span class="op">=</span> <span class="st">"cohort_definition_id"</span>,</span>
<span>    cohortName <span class="op">=</span> <span class="st">"cohort_name"</span>,</span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">cohorts</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 8 × 3</span></span></span>
<span><span class="co">##   cohortId cohortName     type  </span></span>
<span><span class="co">##      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>        1 acetaminophen  event </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>        2 amoxicillin    event </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>        3 aspirin        event </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>        4 clavulanate    event </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>        5 death          exit  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>        6 doxylamine     event </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">7</span>        7 penicillinv    event </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">8</span>        8 viralsinusitis target</span></span></code></pre>
<p>With our <code>data.frame</code> of cohort types, CDM reference, and
the cohort table name in our database we can compute the treatment
pathways, with all of the other settings as their defaults.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/darwin-eu/TreatmentPatterns" class="external-link">TreatmentPatterns</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">defaultSettings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computePathways.html">computePathways</a></span><span class="op">(</span></span>
<span>  cohorts <span class="op">=</span> <span class="va">cohorts</span>,</span>
<span>  cohortTableName <span class="op">=</span> <span class="st">"cohort_table"</span>,</span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## -- Qualifying records for cohort definitions: 1, 2, 3, 4, 5, 6, 7, 8</span></span>
<span><span class="co">##  Records: 14041</span></span>
<span><span class="co">##  Subjects: 2693</span></span></code></pre>
<pre><code><span><span class="co">## -- Removing records &lt; minEraDuration (0)</span></span>
<span><span class="co">##  Records: 11386</span></span>
<span><span class="co">##  Subjects: 2159</span></span></code></pre>
<pre><code><span><span class="co">## &gt;&gt; Starting on target: 8 (viralsinusitis)</span></span></code></pre>
<pre><code><span><span class="co">## -- Removing events where index date &lt; target index date + indexDateOffset (0)</span></span>
<span><span class="co">##  Records: 8366</span></span>
<span><span class="co">##  Subjects: 2144</span></span></code></pre>
<pre><code><span><span class="co">## -- splitEventCohorts</span></span>
<span><span class="co">##  Records: 8366</span></span>
<span><span class="co">##  Subjects: 2144</span></span></code></pre>
<pre><code><span><span class="co">## -- Collapsing eras, eraCollapse (30)</span></span>
<span><span class="co">##  Records: 8366</span></span>
<span><span class="co">##  Subjects: 2144</span></span></code></pre>
<pre><code><span><span class="co">## -- Iteration 1: minPostCombinationDuration (30), combinatinoWindow (30)</span></span>
<span><span class="co">##  Records: 558</span></span>
<span><span class="co">##  Subjects: 512</span></span></code></pre>
<pre><code><span><span class="co">## -- Iteration 2: minPostCombinationDuration (30), combinatinoWindow (30)</span></span>
<span><span class="co">##  Records: 554</span></span>
<span><span class="co">##  Subjects: 512</span></span></code></pre>
<pre><code><span><span class="co">## -- After Combination</span></span>
<span><span class="co">##  Records: 554</span></span>
<span><span class="co">##  Subjects: 512</span></span></code></pre>
<pre><code><span><span class="co">## -- filterTreatments (First)</span></span>
<span><span class="co">##  Records: 553</span></span>
<span><span class="co">##  Subjects: 512</span></span></code></pre>
<pre><code><span><span class="co">## -- treatment construction done</span></span>
<span><span class="co">##  Records: 553</span></span>
<span><span class="co">##  Subjects: 512</span></span></code></pre>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">defaultSettings</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># Andromeda object</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Physical location:  /tmp/RtmpRnHkiA/file2e46731486ac.sqlite</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Tables:</span></span>
<span><span class="co">## $addRowsFRFS_1 (personId, indexYear, eventCohortId, eventStartDate, eventEndDate, type, age, sex, targetCohortId, durationEra, row_person, sortOrder, gapPrevious, selectedRows, switch, combinationFRFS, combinationLRFS, eventStartDateNext, eventEndDatePrevious, eventEndDateNext, eventCohortIdPrevious)</span></span>
<span><span class="co">## $addRowsFRFS_2 (personId, indexYear, eventCohortId, targetCohortId, eventStartDate, age, sex, eventEndDate, durationEra, gapPrevious, sortOrder, selectedRows, switch, combinationFRFS, combinationLRFS, eventStartDateNext, eventEndDatePrevious, eventEndDateNext, eventCohortIdPrevious)</span></span>
<span><span class="co">## $addRowsLRFS_1 (personId, indexYear, eventCohortId, eventStartDate, eventEndDate, type, age, sex, targetCohortId, durationEra, row_person, sortOrder, gapPrevious, selectedRows, switch, combinationFRFS, combinationLRFS, eventStartDateNext, eventEndDatePrevious, eventEndDateNext, eventCohortIdPrevious, checkDuration)</span></span>
<span><span class="co">## $addRowsLRFS_2 (personId, indexYear, eventCohortId, targetCohortId, eventStartDate, age, sex, eventEndDate, durationEra, gapPrevious, sortOrder, selectedRows, switch, combinationFRFS, combinationLRFS, eventStartDateNext, eventEndDatePrevious, eventEndDateNext, eventCohortIdPrevious, checkDuration)</span></span>
<span><span class="co">## $analyses (analysis_id, description)</span></span>
<span><span class="co">## $arguments (analysis_id, arguments)</span></span>
<span><span class="co">## $attrition (number_records, number_subjects, reason_id, reason, time_stamp)</span></span>
<span><span class="co">## $cdm_source_info (cdm_source_name, cdm_source_abbreviation, cdm_holder, source_description, source_documentation_reference, cdm_etl_reference, source_release_date, cdm_release_date, cdm_version, vocabulary_version)</span></span>
<span><span class="co">## $cohortTable (cohortId, personId, subject_id_origin, startDate, endDate, age, sex)</span></span>
<span><span class="co">## $cohortTable_8 (cohortIdEvent, personId, subject_id_origin, startDateEvent, endDateEvent, ageEvent, sexEvent, typeEvent, cohortIdTarget, startDateTarget, endDateTarget, ageTarget, sexTarget, typeTarget, indexYear, indexDate)</span></span>
<span><span class="co">## $cohorts (cohortId, cohortName, type)</span></span>
<span><span class="co">## $currentCohorts (cohortId, personId, subject_id_origin, startDate, endDate, age, sex)</span></span>
<span><span class="co">## $dbplyr_1WRZorR1u5 (number_records, number_subjects, reason_id, reason, time_stamp)</span></span>
<span><span class="co">## $dbplyr_5pWJOAFS8a (number_records, number_subjects, reason_id, reason, time_stamp)</span></span>
<span><span class="co">## $dbplyr_6RTXYj8SWn (number_records, number_subjects, reason_id, reason, time_stamp)</span></span>
<span><span class="co">## $dbplyr_9H5PXKstDn (number_records, number_subjects, reason_id, reason, time_stamp)</span></span>
<span><span class="co">## $dbplyr_BD55Q9nvAe (number_records, number_subjects, reason_id, reason, time_stamp)</span></span>
<span><span class="co">## $dbplyr_KndACw8jLb (number_records, number_subjects, reason_id, reason, time_stamp)</span></span>
<span><span class="co">## $dbplyr_c6hVi7vmXr (number_records, number_subjects, reason_id, reason, time_stamp)</span></span>
<span><span class="co">## $dbplyr_g2ZRmBV2zb (number_records, number_subjects, reason_id, reason, time_stamp)</span></span>
<span><span class="co">## $dbplyr_hYqzXdzCNp (number_records, number_subjects, reason_id, reason, time_stamp)</span></span>
<span><span class="co">## $dbplyr_oLvteQFdqV (number_records, number_subjects, reason_id, reason, time_stamp)</span></span>
<span><span class="co">## $eventCohorts (cohortId, personId, subject_id_origin, startDate, endDate, age, sex, type)</span></span>
<span><span class="co">## $exitCohorts (cohortId, personId, subject_id_origin, startDate, endDate, age, sex, type)</span></span>
<span><span class="co">## $exitHistory (personId, indexYear, eventCohortId, eventStartDate, eventEndDate, age, sex, targetCohortId, durationEra)</span></span>
<span><span class="co">## $labels (eventCohortId, eventCohortName)</span></span>
<span><span class="co">## $metadata (execution_start, package_version, r_version, platform, execution_end)</span></span>
<span><span class="co">## $sqlite_stat1 (tbl, idx, stat)</span></span>
<span><span class="co">## $sqlite_stat4 (tbl, idx, neq, nlt, ndlt, sample)</span></span>
<span><span class="co">## $targetCohorts (cohortId, personId, subject_id_origin, startDate, endDate, age, sex, type, indexYear, indexDate)</span></span>
<span><span class="co">## $treatmentHistory (eventCohortId, personId, indexYear, targetCohortId, eventStartDate, age, sex, eventEndDate, durationEra, sortOrder, eventSeq, eventCohortName)</span></span>
<span><span class="co">## $treatmentHistoryFinal (eventCohortId, personId, indexYear, targetCohortId, eventStartDate, age, sex, eventEndDate, durationEra, sortOrder, eventSeq, eventCohortName)</span></span></code></pre>
<p>The output of <code>computePathways</code> is an <a href="https://ohdsi.github.io/Andromeda/" class="external-link">Andromeda</a> environment,
which allows us to investigate intermediate results and patient-level
data. <strong>This data is not sharable.</strong></p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># treatmentHistory table</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">defaultSettings</span><span class="op">$</span><span class="va">treatmentHistory</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># Source:   SQL [?? x 12]</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Database: sqlite 3.47.1 [/tmp/RtmpRnHkiA/file2e46731486ac.sqlite]</span></span></span>
<span><span class="co">##   eventCohortId personId indexYear targetCohortId eventStartDate   age sex   </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 1                  404      <span style="text-decoration: underline;">1</span>975              8          -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">759</span>     4 FEMALE</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 1                  195      <span style="text-decoration: underline;">1</span>975              8           <span style="text-decoration: underline;">4</span>761    12 MALE  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> 1                  767      <span style="text-decoration: underline;">1</span>975              8            886     4 MALE  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> 1                  825      <span style="text-decoration: underline;">1</span>975              8          -<span style="color: #BB0000; text-decoration: underline;">2</span><span style="color: #BB0000;">341</span>    10 FEMALE</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> 1                 <span style="text-decoration: underline;">1</span>131      <span style="text-decoration: underline;">1</span>975              8           <span style="text-decoration: underline;">3</span>828     4 FEMALE</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> 1                 <span style="text-decoration: underline;">1</span>010      <span style="text-decoration: underline;">1</span>975              8           -<span style="color: #BB0000;">644</span>     4 MALE  </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 5 more variables: eventEndDate &lt;dbl&gt;, durationEra &lt;dbl&gt;, sortOrder &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   eventSeq &lt;int&gt;, eventCohortName &lt;chr&gt;</span></span></span></code></pre>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># metadata table</span></span>
<span><span class="va">defaultSettings</span><span class="op">$</span><span class="va">metadata</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># Source:   table&lt;`metadata`&gt; [?? x 5]</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Database: sqlite 3.47.1 [/tmp/RtmpRnHkiA/file2e46731486ac.sqlite]</span></span></span>
<span><span class="co">##   execution_start package_version r_version               platform execution_end</span></span>
<span><span class="co">##             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>     <span style="text-decoration: underline;">1</span>744<span style="text-decoration: underline;">812</span>321. 3.0.3           R version 4.5.0 (2025-… x86_64-…   <span style="text-decoration: underline;">1</span>744<span style="text-decoration: underline;">812</span>329.</span></span></code></pre>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First Recieved First Stopped</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">defaultSettings</span><span class="op">$</span><span class="va">addRowsFRFS_1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># Source:   SQL [?? x 21]</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Database: sqlite 3.47.1 [/tmp/RtmpRnHkiA/file2e46731486ac.sqlite]</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 21 variables: personId &lt;lgl&gt;, indexYear &lt;lgl&gt;, eventCohortId &lt;lgl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   eventStartDate &lt;dbl&gt;, eventEndDate &lt;lgl&gt;, type &lt;lgl&gt;, age &lt;dbl&gt;, sex &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   targetCohortId &lt;dbl&gt;, durationEra &lt;lgl&gt;, row_person &lt;lgl&gt;, sortOrder &lt;lgl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   gapPrevious &lt;lgl&gt;, selectedRows &lt;lgl&gt;, switch &lt;lgl&gt;, combinationFRFS &lt;lgl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   combinationLRFS &lt;lgl&gt;, eventStartDateNext &lt;lgl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   eventEndDatePrevious &lt;lgl&gt;, eventEndDateNext &lt;lgl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   eventCohortIdPrevious &lt;lgl&gt;</span></span></span></code></pre>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Last Recieved Last Stopped</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">defaultSettings</span><span class="op">$</span><span class="va">addRowsLRFS_1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># Source:   SQL [?? x 22]</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Database: sqlite 3.47.1 [/tmp/RtmpRnHkiA/file2e46731486ac.sqlite]</span></span></span>
<span><span class="co">##   personId indexYear eventCohortId eventStartDate eventEndDate type    age sex  </span></span>
<span><span class="co">##      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>        1      <span style="text-decoration: underline;">1</span>976 2                       <span style="text-decoration: underline;">2</span>346         <span style="text-decoration: underline;">2</span>346 event     5 FEMA…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>        2      <span style="text-decoration: underline;">1</span>981 2                       <span style="text-decoration: underline;">5</span>344         <span style="text-decoration: underline;">5</span>344 event     6 FEMA…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>        3      <span style="text-decoration: underline;">1</span>970 2                       <span style="text-decoration: underline;">9</span>059         <span style="text-decoration: underline;">9</span>059 event    27 FEMA…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>        5      <span style="text-decoration: underline;">1</span>975 2                       <span style="text-decoration: underline;">5</span>274         <span style="text-decoration: underline;">5</span>274 event    11 MALE </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>        6      <span style="text-decoration: underline;">1</span>965 6                      -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">722</span>        -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">722</span> event     7 FEMA…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>       11      <span style="text-decoration: underline;">1</span>989 1                       <span style="text-decoration: underline;">7</span>153         <span style="text-decoration: underline;">7</span>153 event     9 MALE </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 14 more variables: targetCohortId &lt;dbl&gt;, durationEra &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   row_person &lt;int&gt;, sortOrder &lt;dbl&gt;, gapPrevious &lt;dbl&gt;, selectedRows &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   switch &lt;dbl&gt;, combinationFRFS &lt;dbl&gt;, combinationLRFS &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   eventStartDateNext &lt;dbl&gt;, eventEndDatePrevious &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   eventEndDateNext &lt;dbl&gt;, eventCohortIdPrevious &lt;chr&gt;, checkDuration &lt;dbl&gt;</span></span></span></code></pre>
<p><code>DatabaseConnector</code> is also supported. The following
parameters are required <strong>instead</strong> of
<code>cdm</code>:</p>
<ol style="list-style-type: decimal">
<li>
<code>connectionDetails</code>: ConnectionDetails object form <a href="https://ohdsi.github.io/DatabaseConnector/" class="external-link">DatabaseConnector</a>.</li>
<li>
<code>cdmSchema</code>: Schema where the CDM exists.</li>
<li>
<code>resultSchema</code>: Schema to write the cohort table to.</li>
<li>
<code>tempEmulationSchema</code>: Some database platforms like
Oracle and Impala do not truly support temp tables. To emulate temp
tables, provide a schema with write privileges where temp tables can be
created.</li>
</ol>
<p>The following code snippet works with <code>Eunomia</code>, a cohort
table (cohort_table) exists in the database, and a <code>cohorts</code>
data frame has been created.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/computePathways.html">computePathways</a></span><span class="op">(</span></span>
<span>  cohorts <span class="op">=</span> <span class="va">cohorts</span>,</span>
<span>  cohortTableName <span class="op">=</span> <span class="va">cohortTableName</span>,</span>
<span>  connectionDetails <span class="op">=</span> <span class="fu">Eunomia</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Eunomia/man/getEunomiaConnectionDetails.html" class="external-link">getEunomiaConnectionDetails</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  cdmSchema <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>  resultSchema <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>  tempEmulationSchema <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="pathway-settings">Pathway settings<a class="anchor" aria-label="anchor" href="#pathway-settings"></a>
</h2>
<p>Even though the default settings work well for most use cases, it
might not work for all situations. The settings below allow us to
influence how the events of interest should be processed to form
treatment pathways.</p>
<table class="table">
<colgroup>
<col width="22%">
<col width="27%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th>Parameter</th>
<th>Value</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>indexDateOffset</td>
<td>0</td>
<td>Offset the index date of the <code>Target</code> cohort.</td>
</tr>
<tr class="even">
<td>minEraDuration</td>
<td>0</td>
<td>Minimum time an event era should last to be included in
analysis</td>
</tr>
<tr class="odd">
<td>eraCollapseSize</td>
<td>30</td>
<td>Window of time between which two eras of the same event cohort are
collapsed into one era</td>
</tr>
<tr class="even">
<td>combinationWindow</td>
<td>30</td>
<td>Window of time two event cohorts need to overlap to be considered a
combination treatment</td>
</tr>
<tr class="odd">
<td>minPostCombinationDuration</td>
<td>30</td>
<td>Minimum time an event era before or after a generated combination
treatment should last to be included in analysis</td>
</tr>
<tr class="even">
<td>filterTreatments</td>
<td>First</td>
<td>Select first occurrence of (‘First’); changes between (‘Changes’);
or all event cohorts (‘All’).</td>
</tr>
<tr class="odd">
<td>maxPathLength</td>
<td>5</td>
<td>Maximum number of steps included in treatment pathway</td>
</tr>
</tbody>
</table>
<p>The following figure shows how each of these parameters affect the
computation of the treatment pathway.</p>
<p><img src="../reference/figures/pathwaysettings.png" alt="pathwaySettings"> You can add these settings to the
<code>computePathways</code> function call. Lets see what happens when
we set our <code>minEraDuration</code> to <strong>60</strong>, but keep
the rest of the settings mentioned as their default values.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">minEra60</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computePathways.html">computePathways</a></span><span class="op">(</span></span>
<span>  cohorts <span class="op">=</span> <span class="va">cohorts</span>,</span>
<span>  cohortTableName <span class="op">=</span> <span class="st">"cohort_table"</span>,</span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  <span class="co"># Pathway settings</span></span>
<span>  indexDateOffset <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  minEraDuration <span class="op">=</span> <span class="fl">60</span>,</span>
<span>  eraCollapseSize <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  combinationWindow <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  minPostCombinationDuration <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  filterTreatments <span class="op">=</span> <span class="st">"First"</span>,</span>
<span>  maxPathLength <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in validateComputePathways(): The `minPostCombinationDuration` is set</span></span>
<span><span class="co">## lower than the `minEraDuration`, this might result in unexpected behavior</span></span></code></pre>
<pre><code><span><span class="co">## Warning in validateComputePathways(): The `combinationWindow` is set lower than</span></span>
<span><span class="co">## the `minEraDuration`, this might result in unexpected behavior</span></span></code></pre>
<pre><code><span><span class="co">## -- Qualifying records for cohort definitions: 1, 2, 3, 4, 5, 6, 7, 8</span></span>
<span><span class="co">##  Records: 14041</span></span>
<span><span class="co">##  Subjects: 2693</span></span></code></pre>
<pre><code><span><span class="co">## -- Removing records &lt; minEraDuration (60)</span></span>
<span><span class="co">##  Records: 2523</span></span>
<span><span class="co">##  Subjects: 2159</span></span></code></pre>
<pre><code><span><span class="co">## &gt;&gt; Starting on target: 8 (viralsinusitis)</span></span></code></pre>
<pre><code><span><span class="co">## -- Removing events where index date &lt; target index date + indexDateOffset (0)</span></span>
<span><span class="co">##  Records: 336</span></span>
<span><span class="co">##  Subjects: 279</span></span></code></pre>
<pre><code><span><span class="co">## -- splitEventCohorts</span></span>
<span><span class="co">##  Records: 336</span></span>
<span><span class="co">##  Subjects: 279</span></span></code></pre>
<pre><code><span><span class="co">## -- Collapsing eras, eraCollapse (30)</span></span>
<span><span class="co">##  Records: 336</span></span>
<span><span class="co">##  Subjects: 279</span></span></code></pre>
<pre><code><span><span class="co">## -- Iteration 1: minPostCombinationDuration (30), combinatinoWindow (30)</span></span>
<span><span class="co">##  Records: 291</span></span>
<span><span class="co">##  Subjects: 279</span></span></code></pre>
<pre><code><span><span class="co">## -- After Combination</span></span>
<span><span class="co">##  Records: 291</span></span>
<span><span class="co">##  Subjects: 279</span></span></code></pre>
<pre><code><span><span class="co">## -- filterTreatments (First)</span></span>
<span><span class="co">##  Records: 291</span></span>
<span><span class="co">##  Subjects: 279</span></span></code></pre>
<pre><code><span><span class="co">## -- treatment construction done</span></span>
<span><span class="co">##  Records: 291</span></span>
<span><span class="co">##  Subjects: 279</span></span></code></pre>
<p>Number of treatments with a minimum duration of greater or equal to 0
days.</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">defaultSettings</span><span class="op">$</span><span class="va">treatmentHistory</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 553</span></span></code></pre>
<p>Number of treatments with a minimum duration of greater or equal to
60 days.</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">minEra60</span><span class="op">$</span><span class="va">treatmentHistory</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 291</span></span></code></pre>
<div class="section level3">
<h3 id="acute-and-therapy-splits">Acute and Therapy splits<a class="anchor" aria-label="anchor" href="#acute-and-therapy-splits"></a>
</h3>
<p>We can also split our defined event cohorts into
<strong>acute</strong> and <strong>therapy</strong> cohorts.</p>
<table class="table">
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th>Parameter</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>splitEventCohorts</td>
<td>Specify event cohort ID’s (i.e. <code>c(1, 2, 3)</code> to split in
acute (&lt; splitTime days) and therapy (&gt;= splitTime days). As an
example treatment <strong>Drug A</strong> could be split into
<strong>Drug A (therapy)</strong> and <strong>Drug A (acute)</strong>.
And we could set our splitTime to <em>30</em>. <strong>Drug A
(acute)</strong> would be the time before day 0-29 and <strong>Drug A
(therapy)</strong> would be the day 30 or later.</td>
</tr>
<tr class="even">
<td>splitTime</td>
<td>Specify number of days at which each of the split event cohorts
should be split in acute and therapy (i.e. <code>c(20, 30, 10)</code>).
The length of <code>splitTime</code> must equal the length of
<code>splitEventCohorts</code>
</td>
</tr>
</tbody>
</table>
<p>Let’s say we want to assume that the first 60 days of our treatment
is acute, and beyond that therapy.</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">splitAcuteTherapy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computePathways.html">computePathways</a></span><span class="op">(</span></span>
<span>  cohorts <span class="op">=</span> <span class="va">cohorts</span>,</span>
<span>  cohortTableName <span class="op">=</span> <span class="st">"cohort_table"</span>,</span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  <span class="co"># Split settings</span></span>
<span>  splitEventCohorts <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  splitTime <span class="op">=</span> <span class="fl">60</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## -- Qualifying records for cohort definitions: 1, 2, 3, 4, 5, 6, 7, 8</span></span>
<span><span class="co">##  Records: 14041</span></span>
<span><span class="co">##  Subjects: 2693</span></span></code></pre>
<pre><code><span><span class="co">## -- Removing records &lt; minEraDuration (0)</span></span>
<span><span class="co">##  Records: 11386</span></span>
<span><span class="co">##  Subjects: 2159</span></span></code></pre>
<pre><code><span><span class="co">## &gt;&gt; Starting on target: 8 (viralsinusitis)</span></span></code></pre>
<pre><code><span><span class="co">## -- Removing events where index date &lt; target index date + indexDateOffset (0)</span></span>
<span><span class="co">##  Records: 8366</span></span>
<span><span class="co">##  Subjects: 2144</span></span></code></pre>
<pre><code><span><span class="co">## -- splitEventCohorts</span></span>
<span><span class="co">##  Records: 8366</span></span>
<span><span class="co">##  Subjects: 2144</span></span></code></pre>
<pre><code><span><span class="co">## -- Collapsing eras, eraCollapse (30)</span></span>
<span><span class="co">##  Records: 8366</span></span>
<span><span class="co">##  Subjects: 2144</span></span></code></pre>
<pre><code><span><span class="co">## -- Iteration 1: minPostCombinationDuration (30), combinatinoWindow (30)</span></span>
<span><span class="co">##  Records: 558</span></span>
<span><span class="co">##  Subjects: 512</span></span></code></pre>
<pre><code><span><span class="co">## -- Iteration 2: minPostCombinationDuration (30), combinatinoWindow (30)</span></span>
<span><span class="co">##  Records: 554</span></span>
<span><span class="co">##  Subjects: 512</span></span></code></pre>
<pre><code><span><span class="co">## -- After Combination</span></span>
<span><span class="co">##  Records: 554</span></span>
<span><span class="co">##  Subjects: 512</span></span></code></pre>
<pre><code><span><span class="co">## -- filterTreatments (First)</span></span>
<span><span class="co">##  Records: 553</span></span>
<span><span class="co">##  Subjects: 512</span></span></code></pre>
<pre><code><span><span class="co">## -- treatment construction done</span></span>
<span><span class="co">##  Records: 553</span></span>
<span><span class="co">##  Subjects: 512</span></span></code></pre>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">splitAcuteTherapy</span><span class="op">$</span><span class="va">treatmentHistory</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">eventCohortName</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "acetaminophen (acute)"             "acetaminophen (acute)+amoxicillin"</span></span>
<span><span class="co">## [3] "acetaminophens (therapy)"          "amoxicillin"                      </span></span>
<span><span class="co">## [5] "amoxicillin+clavulanate"           "aspirin"                          </span></span>
<span><span class="co">## [7] "clavulanate"</span></span></code></pre>
<p>We can see that our Acetaminophen cohorts are split into
Acetaminophen <strong>(acute)</strong> and <strong>(therapy)</strong>.
<em>Acute</em> labels all the Acetaminophen cohorts lasting less than
our defined <code>splitTime</code>, in this case 60 days.
<em>Therapy</em> labels all the Acetaminophen cohorts lasting 60 days or
more.</p>
</div>
<div class="section level3">
<h3 id="include-treatments-in-a-time-frame">Include treatments in a time frame<a class="anchor" aria-label="anchor" href="#include-treatments-in-a-time-frame"></a>
</h3>
<p>We can dictate in what time frame we want to look. We can look from
the start date of our target cohort and on wards, or we can look before
the end date of our target cohort. By default
<code>TreatmentPatterns</code> looks from the start date and
onwards.</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">includeEndDate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computePathways.html">computePathways</a></span><span class="op">(</span></span>
<span>  cohorts <span class="op">=</span> <span class="va">cohorts</span>,</span>
<span>  cohortTableName <span class="op">=</span> <span class="st">"cohort_table"</span>,</span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  <span class="co"># Split settings</span></span>
<span>  includeTreatments <span class="op">=</span> <span class="st">"endDate"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## -- Qualifying records for cohort definitions: 1, 2, 3, 4, 5, 6, 7, 8</span></span>
<span><span class="co">##  Records: 14041</span></span>
<span><span class="co">##  Subjects: 2693</span></span></code></pre>
<pre><code><span><span class="co">## -- Removing records &lt; minEraDuration (0)</span></span>
<span><span class="co">##  Records: 11386</span></span>
<span><span class="co">##  Subjects: 2159</span></span></code></pre>
<pre><code><span><span class="co">## &gt;&gt; Starting on target: 8 (viralsinusitis)</span></span></code></pre>
<pre><code><span><span class="co">## -- Removing events where index date &lt; target index date + indexDateOffset (0)</span></span>
<span><span class="co">##  Records: 8366</span></span>
<span><span class="co">##  Subjects: 2144</span></span></code></pre>
<pre><code><span><span class="co">## -- splitEventCohorts</span></span>
<span><span class="co">##  Records: 8366</span></span>
<span><span class="co">##  Subjects: 2144</span></span></code></pre>
<pre><code><span><span class="co">## -- Collapsing eras, eraCollapse (30)</span></span>
<span><span class="co">##  Records: 8366</span></span>
<span><span class="co">##  Subjects: 2144</span></span></code></pre>
<pre><code><span><span class="co">## -- Iteration 1: minPostCombinationDuration (30), combinatinoWindow (30)</span></span>
<span><span class="co">##  Records: 558</span></span>
<span><span class="co">##  Subjects: 512</span></span></code></pre>
<pre><code><span><span class="co">## -- Iteration 2: minPostCombinationDuration (30), combinatinoWindow (30)</span></span>
<span><span class="co">##  Records: 554</span></span>
<span><span class="co">##  Subjects: 512</span></span></code></pre>
<pre><code><span><span class="co">## -- After Combination</span></span>
<span><span class="co">##  Records: 554</span></span>
<span><span class="co">##  Subjects: 512</span></span></code></pre>
<pre><code><span><span class="co">## -- filterTreatments (First)</span></span>
<span><span class="co">##  Records: 553</span></span>
<span><span class="co">##  Subjects: 512</span></span></code></pre>
<pre><code><span><span class="co">## -- treatment construction done</span></span>
<span><span class="co">##  Records: 553</span></span>
<span><span class="co">##  Subjects: 512</span></span></code></pre>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span></span>
<span>  <span class="va">includeEndDate</span><span class="op">$</span><span class="va">treatmentHistory</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">personId</span><span class="op">)</span>,</span>
<span>  <span class="va">defaultSettings</span><span class="op">$</span><span class="va">treatmentHistory</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">personId</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<p>In our example case for Viral Sinusitis it appears to not matter, as
the personID’s are identical.</p>
</div>
</div>
<div class="section level2">
<h2 id="exporting-result-objects">Exporting result objects<a class="anchor" aria-label="anchor" href="#exporting-result-objects"></a>
</h2>
<p>The <code>export</code> function allows us to export the generated
result objects from <code>computePathways</code>. There are several
arguments that we can change to alter the behavior, depending on what we
are allowed to share.</p>
<div class="section level3">
<h3 id="mincellcount-and-censortype">minCellCount and censorType<a class="anchor" aria-label="anchor" href="#mincellcount-and-censortype"></a>
</h3>
<p>Let’s say we are only able to share results of groups of subjects
that have at least 5 subjects in them.</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/export.html">export</a></span><span class="op">(</span></span>
<span>  andromeda <span class="op">=</span> <span class="va">defaultSettings</span>,</span>
<span>  minCellCount <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can also choose between different methods how to handle pathways
that fall below are specified <code>minCellCount</code>. These types are
<strong>1</strong>) <code>"cellCount"</code>, <strong>2</strong>)
<code>"remove"</code>, and <strong>3</strong>) <code>"mean"</code>.</p>
<p>We could say we want to censor all pathways that fall below the
<code>minCellCount</code> to be censored <em>to</em> the
<code>minCellCount</code>.</p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resultsA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/export.html">export</a></span><span class="op">(</span></span>
<span>  andromeda <span class="op">=</span> <span class="va">minEra60</span>,</span>
<span>  minCellCount <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  censorType <span class="op">=</span> <span class="st">"minCellCount"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Or we could completely remove them</p>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resultsB</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/export.html">export</a></span><span class="op">(</span></span>
<span>  andromeda <span class="op">=</span> <span class="va">minEra60</span>,</span>
<span>  minCellCount <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  censorType <span class="op">=</span> <span class="st">"remove"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Or finally we can censor them as the mean of all the groups that fall
below the <code>minCellCount</code>.</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resultsC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/export.html">export</a></span><span class="op">(</span></span>
<span>  andromeda <span class="op">=</span> <span class="va">minEra60</span>,</span>
<span>  minCellCount <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  censorType <span class="op">=</span> <span class="st">"mean"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="agewindow">ageWindow<a class="anchor" aria-label="anchor" href="#agewindow"></a>
</h3>
<p>We can also specify an age window.</p>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resultsD</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/export.html">export</a></span><span class="op">(</span></span>
<span>  andromeda <span class="op">=</span> <span class="va">splitAcuteTherapy</span>,</span>
<span>  minCellCount <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  censorType <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  ageWindow <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Or a collection of ages.</p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resultsE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/export.html">export</a></span><span class="op">(</span></span>
<span>  andromeda <span class="op">=</span> <span class="va">splitAcuteTherapy</span>,</span>
<span>  minCellCount <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  censorType <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  ageWindow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">18</span>, <span class="fl">25</span>, <span class="fl">30</span>, <span class="fl">40</span>, <span class="fl">50</span>, <span class="fl">60</span>, <span class="fl">150</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="archivename">archiveName<a class="anchor" aria-label="anchor" href="#archivename"></a>
</h3>
<p>Finally we can also specify an <code>archiveName</code> which is the
name of a zip-file to zip all our output csv-files to.</p>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resultsF</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/export.html">export</a></span><span class="op">(</span></span>
<span>  andromeda <span class="op">=</span> <span class="va">includeEndDate</span>,</span>
<span>  minCellCount <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  censorType <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  ageWindow <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  archiveName <span class="op">=</span> <span class="st">"output.zip"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="all-in-one">All-in-one<a class="anchor" aria-label="anchor" href="#all-in-one"></a>
</h2>
<p>Instead of using <code>computePathways</code> and
<code>export</code>, instead we could use
<code>executeTreatmentPatterns</code>. Which is an all-in-one function
that trades full control for convenience.</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resultsG</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/executeTreatmentPatterns.html">executeTreatmentPatterns</a></span><span class="op">(</span></span>
<span>  cohorts <span class="op">=</span> <span class="va">cohorts</span>,</span>
<span>  cohortTableName <span class="op">=</span> <span class="st">"cohort_table"</span>,</span>
<span>  cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>  minEraDuration <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  eraCollapseSize <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  combinationWindow <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  minCellCount <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## -- Qualifying records for cohort definitions: 1, 2, 3, 4, 5, 6, 7, 8</span></span>
<span><span class="co">##  Records: 14041</span></span>
<span><span class="co">##  Subjects: 2693</span></span></code></pre>
<pre><code><span><span class="co">## -- Removing records &lt; minEraDuration (0)</span></span>
<span><span class="co">##  Records: 11386</span></span>
<span><span class="co">##  Subjects: 2159</span></span></code></pre>
<pre><code><span><span class="co">## &gt;&gt; Starting on target: 8 (viralsinusitis)</span></span></code></pre>
<pre><code><span><span class="co">## -- Removing events where index date &lt; target index date + indexDateOffset (0)</span></span>
<span><span class="co">##  Records: 8366</span></span>
<span><span class="co">##  Subjects: 2144</span></span></code></pre>
<pre><code><span><span class="co">## -- splitEventCohorts</span></span>
<span><span class="co">##  Records: 8366</span></span>
<span><span class="co">##  Subjects: 2144</span></span></code></pre>
<pre><code><span><span class="co">## -- Collapsing eras, eraCollapse (30)</span></span>
<span><span class="co">##  Records: 8366</span></span>
<span><span class="co">##  Subjects: 2144</span></span></code></pre>
<pre><code><span><span class="co">## -- Iteration 1: minPostCombinationDuration (30), combinatinoWindow (30)</span></span>
<span><span class="co">##  Records: 558</span></span>
<span><span class="co">##  Subjects: 512</span></span></code></pre>
<pre><code><span><span class="co">## -- Iteration 2: minPostCombinationDuration (30), combinatinoWindow (30)</span></span>
<span><span class="co">##  Records: 554</span></span>
<span><span class="co">##  Subjects: 512</span></span></code></pre>
<pre><code><span><span class="co">## -- After Combination</span></span>
<span><span class="co">##  Records: 554</span></span>
<span><span class="co">##  Subjects: 512</span></span></code></pre>
<pre><code><span><span class="co">## -- filterTreatments (First)</span></span>
<span><span class="co">##  Records: 553</span></span>
<span><span class="co">##  Subjects: 512</span></span></code></pre>
<pre><code><span><span class="co">## -- treatment construction done</span></span>
<span><span class="co">##  Records: 553</span></span>
<span><span class="co">##  Subjects: 512</span></span></code></pre>
<pre><code><span><span class="co">## Censoring 534 pathways with a frequency &lt;5 to mean.</span></span></code></pre>
<p>When using <code>DatabaseConnector</code> we can substitute the
<code>cdm</code> object with <code>connectionDetails</code>,
<code>cdmSchema</code>, <code>resultSchema</code>, and
<code>tempEmulationSchema</code>.</p>
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/executeTreatmentPatterns.html">executeTreatmentPatterns</a></span><span class="op">(</span></span>
<span>  cohorts <span class="op">=</span> <span class="va">cohorts</span>,</span>
<span>  cohortTableName <span class="op">=</span> <span class="st">"cohort_table"</span>,</span>
<span>  connectionDetails <span class="op">=</span> <span class="fu">Eunomia</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Eunomia/man/getEunomiaConnectionDetails.html" class="external-link">getEunomiaConnectionDetails</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  cdmSchema <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>  resultSchema <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>  tempEmulationSchema <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  minEraDuration <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  eraCollapseSize <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  combinationWindow <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  minCellCount <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="evaluating-output">Evaluating output<a class="anchor" aria-label="anchor" href="#evaluating-output"></a>
</h2>
<p>Now that we have exported our output, in various ways, we can
evaluate the output. As you may have noticed the <code>export</code>
function exports 6 csv-files: <strong>1</strong>) treatmentPathways.csv,
<strong>2</strong>) countsAge.csv, <strong>3</strong>) countsSex.csv,
<strong>4</strong>) countsYear.csv, <strong>5</strong>)
summaryStatsTherapyDuraion.csv, and <strong>6</strong>) metadata.csv</p>
<div class="section level3">
<h3 id="treatmentpathways">treatmentPathways<a class="anchor" aria-label="anchor" href="#treatmentpathways"></a>
</h3>
<p>The treatmentPathways file contains all the pathways found, with a
frequency, pairwise stratified by age group, sex and index year.</p>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span><span class="op">$</span><span class="va">treatment_pathways</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 12 × 8</span></span></span>
<span><span class="co">##    pathway              freq age   sex   index_year analysis_id target_cohort_id</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> aspirin               211 all   all   all                  1                8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> acetaminophen         206 all   all   all                  1                8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> amoxicillin+clavul…    48 all   all   all                  1                8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> acetaminophen-aspi…    14 all   all   all                  1                8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> aspirin-acetaminop…    12 all   all   all                  1                8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> acetaminophen-amox…     6 all   all   all                  1                8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> aspirin-amoxicilli…     6 all   all   all                  1                8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> clavulanate             3 all   all   all                  1                8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> amoxicillin             2 all   all   all                  1                8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> amoxicillin+clavul…     2 all   all   all                  1                8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">11</span> acetaminophen+amox…     1 all   all   all                  1                8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">12</span> amoxicillin+clavul…     1 all   all   all                  1                8</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 1 more variable: target_cohort_name &lt;chr&gt;</span></span></span></code></pre>
<p>We can see the pathways contain the treatment names we provided in
our event cohorts. Besides that we also see the paths are annoted with a
<code>+</code> or <code>-</code>. The <code>+</code> indicates two
treatments are a combination therapy,
i.e. <code>Acetaminophen+Amoxicillin</code> is a combination of
<em>Acetaminophen</em> and <em>Amoxicillin</em>. The <code>-</code>
indicates a switch between treatments,
i.e. <code>Aspirin-Acetaminophen</code> is a switch from
<em>Aspirin</em> to <em>Acetaminophen</em>. Note that these combinations
and switches can occur in the same pathway,
i.e. <code>Amoxicillin+Clavulanate-Aspirin</code>. The first treatment
is a combination of <em>Amoxicillin</em> and <em>Clavulanate</em> that
switches to <em>Aspirin</em>.</p>
</div>
<div class="section level3">
<h3 id="countsage-countssex-and-countsyear">countsAge, countsSex, and countsYear<a class="anchor" aria-label="anchor" href="#countsage-countssex-and-countsyear"></a>
</h3>
<p>The countsAge, countsSex, and countsYear contain counts per age, sex,
and index year.</p>
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">counts_age</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 5</span></span></span>
<span><span class="co">##     age n     analysis_id target_cohort_id target_cohort_name</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>     1 18              1                8 viralsinusitis    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>     2 55              1                8 viralsinusitis    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>     3 45              1                8 viralsinusitis    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>     4 37              1                8 viralsinusitis    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>     5 33              1                8 viralsinusitis    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>     6 32              1                8 viralsinusitis</span></span></code></pre>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">counts_sex</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 5</span></span></span>
<span><span class="co">##   sex    n     analysis_id target_cohort_id target_cohort_name</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> FEMALE 254             1                8 viralsinusitis    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> MALE   258             1                8 viralsinusitis</span></span></code></pre>
<div class="sourceCode" id="cb135"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">counts_year</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 5</span></span></span>
<span><span class="co">##   index_year n     analysis_id target_cohort_id target_cohort_name</span></span>
<span><span class="co">##        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>       <span style="text-decoration: underline;">1</span>975 512             1                8 viralsinusitis</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="summarystatstherapyduration">summaryStatsTherapyDuration<a class="anchor" aria-label="anchor" href="#summarystatstherapyduration"></a>
</h3>
<p>The summaryEventDuration file contains summary statistics from
different events, across all found “lines”. A “line” is equal to the
level in the Sunburst or Sankey diagrams. The summary statistics allow
for plotting of boxplots with the <code><a href="../reference/plotEventDuration.html">plotEventDuration()</a></code>
function.</p>
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span><span class="op">$</span><span class="fu">plotEventDuration</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="ComputingTreatmentPathways_files/figure-html/summaryStatsTherapyDuration-1.png" width="700">
Or we can use the function</p>
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotEventDuration.html">plotEventDuration</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">summary_event_duration</span><span class="op">)</span></span></code></pre></div>
<p><img src="ComputingTreatmentPathways_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="metadata">metadata<a class="anchor" aria-label="anchor" href="#metadata"></a>
</h3>
<p>The metadata file is a file that contains information about the
circumstances the analysis was performed in, and information about R,
and the CDM.</p>
<div class="sourceCode" id="cb139"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span><span class="op">$</span><span class="va">metadata</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 6</span></span></span>
<span><span class="co">##   execution_start package_version r_version   platform execution_end analysis_id</span></span>
<span><span class="co">##             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>     <span style="text-decoration: underline;">1</span>744<span style="text-decoration: underline;">812</span>321. 3.0.3           R version … x86_64-…   <span style="text-decoration: underline;">1</span>744<span style="text-decoration: underline;">812</span>329.           1</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="sunburst-plot-sankey-diagram">Sunburst Plot &amp; Sankey Diagram<a class="anchor" aria-label="anchor" href="#sunburst-plot-sankey-diagram"></a>
</h3>
<p>From the filtered treatmentPathways file we are able to create a
sunburst plot.</p>
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span><span class="op">$</span><span class="fu">plotSunburst</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sunburst html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:700px;height:432.632880098888px; position:relative;">
<div>
<div class="sunburst-main">
<div class="sunburst-sequence"></div>
<div class="sunburst-chart">
<div class="sunburst-explanation" style="visibility:hidden;"></div>
</div>
</div>
<div class="sunburst-sidebar">
<input type="checkbox" class="sunburst-togglelegend" style="visibility:hidden;">Legend
<div class="sunburst-legend" style="visibility:hidden;"></div>
</div>
</div>
</div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"data":{"children":[{"name":"aspirin","children":[{"name":"acetaminophen","size":12,"colname":"X2"},{"name":"amoxicillin+clavulanate","size":6,"colname":"X2"}],"size":211,"colname":"X1"},{"name":"acetaminophen","children":[{"name":"aspirin","size":14,"colname":"X2"},{"name":"amoxicillin+clavulanate","size":6,"colname":"X2"}],"size":206,"colname":"X1"},{"name":"amoxicillin+clavulanate","children":[{"name":"aspirin","size":2,"colname":"X2"},{"name":"acetaminophen","size":1,"colname":"X2"}],"size":48,"colname":"X1"},{"name":"clavulanate","children":[],"size":3,"colname":"X1"},{"name":"amoxicillin","children":[],"size":2,"colname":"X1"},{"name":"acetaminophen+amoxicillin","children":[],"size":1,"colname":"X1"}],"name":"root"},"options":{"legendOrder":null,"colors":null,"valueField":"size","percent":true,"count":false,"explanation":null,"breadcrumb":[],"legend":[],"sortFunction":"function (a, b) {return a.value - b.value;}","sumNodes":true}},"evals":["options.sortFunction"],"jsHooks":[]}</script><p>Or a Sankey Diagram.</p>
<div class="sourceCode" id="cb142"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span><span class="op">$</span><span class="fu">plotSankey</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sankeyNetwork html-widget html-fill-item" id="htmlwidget-e5c8c404fe174e4c81bd" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"links":{"source":[0,0,0,1,2,3,3,3,4,4,4,5],"target":[6,7,8,8,8,7,8,9,6,8,9,8],"value":[1.17,2.73,40.23,0.2,0.39,0.39,9.380000000000001,0.2,1.17,41.21,2.34,0.59]},"nodes":{"name":["1.acetaminophen","1.acetaminophen+amoxicillin","1.amoxicillin","1.amoxicillin+clavulanate","1.aspirin","1.clavulanate","2.amoxicillin+clavulanate","2.aspirin","2.Stopped","2.acetaminophen"],"group":["1.acetaminophen","1.acetaminophen+amoxicillin","1.amoxicillin","1.amoxicillin+clavulanate","1.aspirin","1.clavulanate","2.amoxicillin+clavulanate","2.aspirin","2.Stopped","2.acetaminophen"]},"options":{"NodeID":"names","NodeGroup":"names","LinkGroup":null,"colourScale":"d3.scaleOrdinal(d3.schemeCategory20)","fontSize":7,"fontFamily":null,"nodeWidth":15,"nodePadding":10,"units":"%","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":32,"sinksRight":true}},"evals":[],"jsHooks":[]}</script><p>Both plots are interactive in an HTML-environment, and are easy to
include in shiny applications.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Aniek Markus, Maarten van Kessel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
